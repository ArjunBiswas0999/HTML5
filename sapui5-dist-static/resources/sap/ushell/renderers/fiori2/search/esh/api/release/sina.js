/*
 * SAP InA UI Toolkit DU - New Wave Search and Analytics
 * version 0.0.0 - 2013-10-21 - commit unknown (inofficial dev version)
 * http://help.sap.com/hana_platform
 * Copyright (c) 2013 SAP AG; All rights reserved
 */
/*
 * @file Proxy class to buffer InA JSON requests/responses.
 * @author Mathias Baumann
 * @namespace sap.bc.inauitk
 * @copyright Copyright (c) 2012 SAP AG. All rights reserved.
 */
(function($){"use strict";var g=window;g.sap=g.sap||{};g.sap.bc=g.sap.bc||{};g.sap.bc.inauitk=g.sap.bc.inauitk||{};var i=g.sap.bc.inauitk;var m=i;m.Proxy=function(){this.init.apply(this,arguments)};var c=g.sap.bc.inauitk.config;m.inaReqResBuffer={};m.Proxy.prototype={init:function(a){var s=this;s.properties=a||{};s.xsrfToken="";s.properties.cachelifetime=s.properties.cachelifetime||0;s.properties.httpMethod=s.properties.httpMethod||'post';if(s.properties.cachelifetime>0){g.window.setInterval(function(){m.inaReqResBuffer={}},s.properties.cachelifetime)}},ajax:function(r){var s=this;var a=JSON.stringify(r.data);if(s.properties.cachelifetime>0){var b=m.inaReqResBuffer[a];if(b){var j={};j.done=function(e){e(b)};j.fail=function(e){};return j}}r.processData=r.processData||false;r.type=r.type||s.properties.httpMethod||"POST";if(a){if(r.type.toLowerCase()==='get'){r.data='Request='+a}else{r.data=a}}if(!s.xsrfToken){r.headers={"X-CSRF-Token":"Fetch"}}else{r.headers={"X-CSRF-Token":s.xsrfToken}}var d=$.ajax(r);d.done(function(){s.xsrfToken=d.getResponseHeader("X-CSRF-Token")||s.xsrfToken||""});if(s.properties.cachelifetime>0){d.done(function(e){m.inaReqResBuffer[a]=e})}return d}};var p;if(c){p={httpMethod:c.hasOwnProperty("get")?"Get":c.httpMethod,cachelifetime:c.cachelifetime}}i.proxy=new m.Proxy(p)})(window.$);
/*
 * Simple info access (SINA) API: JSON Templates
 * Package: sap.bc.ina.api.simple.impl.inav2.jsontemplates
 * Copyright (c) 2013 SAP AG. All rights reserved.
 */
(function(g){"use strict";var $=g.$;g.sap=g.sap||{};g.sap.bc=g.sap.bc||{};g.sap.bc.ina=g.sap.bc.ina||{};g.sap.bc.ina.api=g.sap.bc.ina.api||{};g.sap.bc.ina.api.impl=g.sap.bc.ina.api.impl||{};g.sap.bc.ina.api.impl.inav2=g.sap.bc.ina.api.impl.inav2||{};g.sap.bc.ina.api.impl.inav2.jsontemplates=g.sap.bc.ina.api.impl.inav2.jsontemplates||{};var j=g.sap.bc.ina.api.impl.inav2.jsontemplates;var m=j;m.dataSourceMetaDataRequest={"DataSource":{},"Options":["SynchronousRun"],"Metadata":{"Context":"Search","Expand":["Cube"]},"ServiceVersion":204};m.catalogRequest={"DataSource":{"ObjectName":"$$DataSources$$","PackageName":"ABAP"},"Options":["SynchronousRun"],"Search":{"Top":1000,"Skip":0,"OrderBy":[{"AttributeName":"Description","SortOrder":"ASC"},{"AttributeName":"ObjectName","SortOrder":"ASC"}],"Expand":["Grid","Items"],"Filter":{"Selection":{"Operator":{"Code":"And","SubSelections":[{"MemberOperand":{"AttributeName":"SupportedService","Comparison":"=","Value":"Search"}}]}}},"NamedValues":[{"AttributeName":"ObjectName","Name":"ObjectName"},{"AttributeName":"Description","Name":"Description"},{"AttributeName":"Type","Name":"Type"}]},"SearchTerms":"*","ServiceVersion":204};m.suggestionRequest={"DataSource":{},"Options":["SynchronousRun"],"Suggestions":{"Expand":["Grid","Items"],"Precalculated":false,"SearchTerms":"","AttributeNames":[]},"ServiceVersion":204};m.suggestion2Request={"DataSource":{},"Options":["SynchronousRun"],"Suggestions2":{"Expand":["Grid","Items"],"Precalculated":false,"AttributeNames":[]},"ServiceVersion":204};m.perspectiveRequest={"DataSource":{},"Options":["SynchronousRun"],"Search":{"Expand":["Grid","Items","ResultsetFacets","TotalCount"],"Filter":{"Selection":{"Operator":{"Code":"And","SubSelections":[{"MemberOperand":{"AttributeName":"$$RenderingTemplatePlatform$$","Comparison":"=","Value":"html"}},{"MemberOperand":{"AttributeName":"$$RenderingTemplateTechnology$$","Comparison":"=","Value":"Tempo"}},{"MemberOperand":{"AttributeName":"$$RenderingTemplateType$$","Comparison":"=","Value":"ResultItem"}}]}}},"Top":10,"Skip":0,"SearchTerms":"S*","NamedValues":[{"Function":"WhyFound","Name":"$$WhyFound$$"},{"Function":"RelatedActions","Name":"$$RelatedActions$$"}]},"ServiceVersion":204};m.perspectiveRequestFactsheet={"DataSource":{},"Options":["SynchronousRun"],"Search":{"Expand":["Grid","Items","ResultsetFacets","TotalCount"],"Filter":{"Selection":{"Operator":{"Code":"And","SubSelections":[{"MemberOperand":{"AttributeName":"$$RenderingTemplatePlatform$$","Comparison":"=","Value":"html"}},{"MemberOperand":{"AttributeName":"$$RenderingTemplateTechnology$$","Comparison":"=","Value":"Tempo"}},{"MemberOperand":{"AttributeName":"$$RenderingTemplateType$$","Comparison":"=","Value":"ResultItem"}}]}}},"Top":10,"Skip":0,"SearchTerms":"S*","NamedValues":[{"Function":"WhyFound","Name":"$$WhyFound$$"},{"AttributeName":"$$RelatedActions$$"},{"AttributeName":"$$RelatedActions.Proxy$$"}]},"ServiceVersion":204};m.searchRequest={"DataSource":{},"SearchTerms":"DUMMY","Search":{"Expand":["Grid","Items","TotalCount"],"Top":"DUMMY","Skip":"DUMMY","SelectedValues":"DUMMY","NamedValues":[{"AttributeName":"$$ResultItemAttributes$$","Name":"$$ResultItemAttributes$$"},{"AttributeName":"$$RelatedActions$$","Name":"$$RelatedActions$$"}]}};m.chartRequest={"DataSource":{},"SearchTerms":"","Analytics":{"Definition":{"Dimensions":[{"Axis":"Rows","Name":"CATEGORY","SortOrder":1,"Top":5},{"Axis":"Columns","Name":"CustomDimension1","Members":[{"Aggregation":"COUNT","AggregationDimension":"CATEGORY","MemberOperand":{"AttributeName":"Measures","Comparison":"=","Value":"COUNT"},"Name":"COUNT","SortOrder":2}]}],"Filter":{}}}}})(window);
/*
 * @file Simple info access (SINA) API: Filter
 * @namespace sap.bc.ina.api.impl.inav2.filter
 * @copyright Copyright (c) 2013 SAP AG. All rights reserved.
 */
(function(g){"use strict";var e=function($){if(!$){$=g.$}g.sap=g.sap||{};g.sap.bc=g.sap.bc||{};g.sap.bc.ina=g.sap.bc.ina||{};g.sap.bc.ina.api=g.sap.bc.ina.api||{};g.sap.bc.ina.api.impl=g.sap.bc.ina.api.impl||{};g.sap.bc.ina.api.impl.inav2=g.sap.bc.ina.api.impl.inav2||{};g.sap.bc.ina.api.impl.inav2.filter=g.sap.bc.ina.api.impl.inav2.filter||{};var f=g.sap.bc.ina.api.impl.inav2.filter;var m=f;m.DataSource=function(){this.init.apply(this,arguments)};m.DataSourceMetaData=function(){this.init.apply(this,arguments)};m.Filter=function(){this.init.apply(this,arguments)};m.Condition=function(){this.init.apply(this,arguments)};m.ConditionGroup=function(){this.init.apply(this,arguments)};m.DataSourceMetaData.prototype={init:function(p){p=p||{};this.datasource=p.datasource||{};this.description=p.description||"";this.dimensions={}},_getMetaDataRequest:function(){var r=g.sap.bc.ina.api.impl.inav2.jsontemplates.dataSourceMetaDataRequest;r.DataSource=this.datasource.toInAJson();return r},_getMetaData:function(i,c){var s=this;var r={async:i,url:g.sap.bc.ina.api.sina.system().properties.inaUrl,processData:false,contentType:'application/json',dataType:'json',data:this._getMetaDataRequest()};var j=g.sap.bc.ina.api.sina.system().proxy.ajax(r);j.done(function(d){if(!s.rawMetadata){s._parseServerMetaData(d)}if(c){c(s)}});return this},_parseServerMetaData:function(a){this.rawMetadata=a;this.description=this.rawMetadata.Cube.Description;this.datasource.setLabel(this.description);for(var i=0;i<this.rawMetadata.Cube.Dimensions.length;i++){var d={};d.name=this.rawMetadata.Cube.Dimensions[i].Name;d.description=this.rawMetadata.Cube.Dimensions[i].Description;d.attributes={};for(var j=0;j<this.rawMetadata.Cube.Dimensions[i].Attributes.length;j++){d.attributes[this.rawMetadata.Cube.Dimensions[i].Attributes[j].Name]={name:this.rawMetadata.Cube.Dimensions[i].Attributes[j].Name,description:this.rawMetadata.Cube.Dimensions[i].Attributes[j].Description}}this.dimensions[d.name]=d}}};m.DataSource.prototype={init:function(p){p=p||{};p.schemaName=p.schemaName||p.SchemaName||{};this.setSchemaName(p.schemaName);p.packageName=p.packageName||p.PackageName||{};this.setPackageName(p.packageName);p.objectName=p.objectName||p.ObjectName||{};this.setObjectName(p.objectName);p.type=p.type||p.Type||{};this.setType(p.type);this.label=p.label||p.Label||p.Description||'';this.setMetaData(p.metaData)},getMetaData:function(c){var s=this;if(!s.metaData){s.metaData=new m.DataSourceMetaData({datasource:this})}s.metaData._getMetaData(true,c)},getMetaDataSync:function(){var s=this;if(!s.metaData){s.metaData=new m.DataSourceMetaData({datasource:this});s.metaData._getMetaData(false)}return s.metaData},setMetaData:function(d){this.metaData=d},getSchemaName:function(){return this.schemaName},setSchemaName:function(s){if(!this.schemaName){this.schemaName={}}if($.type(s)==='object'){this.schemaName.label=s.label||s.value||'';this.schemaName.value=s.value||''}if($.type(s)==='string'){this.schemaName.label=s;this.schemaName.value=s}},getPackageName:function(){return this.packageName},setPackageName:function(p){if(!this.packageName){this.packageName={}}if($.type(p)==='object'){this.packageName.label=p.label||p.value||'';this.packageName.value=p.value||''}if($.type(p)==='string'){this.packageName.label=p;this.packageName.value=p}},getObjectName:function(){return this.objectName},setObjectName:function(o){if(!this.objectName){this.objectName={}}if($.type(o)==='object'){this.objectName.label=o.label||o.value||'';this.objectName.value=o.value||''}if($.type(o)==='string'){this.objectName.label=o;this.objectName.value=o}},setObjectNameValue:function(v){if(!this.objectName){this.objectName={}}this.objectName.value=v||''},setObjectNameLabel:function(l){if(!this.objectName){this.objectName={}}this.objectName.label=l||''},getType:function(){return this.type},setType:function(t){if(!this.type){this.type={}}if($.type(t)==='object'){this.type.label=t.label||t.value||'';this.type.value=t.value||''}if($.type(t)==='string'){this.type.label=t;this.type.value=t}},getLabel:function(){if(typeof this.label!=="undefined"&&this.label!==""){return this.label}if(typeof this.getObjectName().label!=="undefined"&&this.getObjectName().label!==""){return this.getObjectName().label}if(typeof this.getObjectName().value!=="undefined"&&this.getObjectName().value!==""){return this.getObjectName().value}return""},setLabel:function(l){this.label=l||''},fromInAJson:function(i){this.setSchemaName({value:i.SchemaName,label:i.SchemaLabel});this.setPackageName({value:i.PackageName,label:i.PackageLabel});this.setObjectName({value:i.ObjectName,label:i.ObjectLabel});this.setType({value:i.Type,label:''})},toInAJson:function(){var j={"SchemaName":this.getSchemaName().value,"PackageName":this.getPackageName().value,"ObjectName":this.getObjectName().value};if(this.getType().value){j.Type=this.getType().value}return j},toURL:function(){var j={"sn":this.getSchemaName().value,"pn":this.getPackageName().value,"on":this.getObjectName().value};if(this.getType().value){j.tn=this.getType().value}return j},fromURL:function(i){this.setSchemaName(i.sn);this.setPackageName(i.pn);this.setObjectName(i.on);this.setType(i.tn)}};m.Filter.prototype={init:function(p){p=p||{};this.setDataSource(p.dataSource,false);this.root=null;this.conditionGroupsByAttribute={};this.defaultConditionGroup=new m.ConditionGroup({operator:'And'});this.searchTerms=""},addFilterConditionGroup:function(c){this.defaultConditionGroup.addCondition(c)},addFilterCondition:function(a,o,v){if(a===undefined||o===undefined||v===undefined){return this}if(this.conditionGroupsByAttribute[a]===undefined){this.conditionGroupsByAttribute[a]=new m.ConditionGroup({operator:"OR"});this.defaultConditionGroup.addCondition(this.conditionGroupsByAttribute[a])}this.conditionGroupsByAttribute[a].addCondition(new m.Condition(a,o,v));return this},getFilterConditions:function(){return this.defaultConditionGroup},getJson:function(){var r=[];this.defaultConditionGroup.getJson(r);var a={Selection:r[0]};return a},getSearchTerms:function(){return this.searchTerms},empty:function(){this.root=null;this.conditionGroupsByAttribute={};this.defaultConditionGroup=new m.ConditionGroup({operator:'And'});this.searchTerms="";return this},getDataSource:function(){return this.dataSource},removeFilterCondition:function(a,o,v){this.defaultConditionGroup.removeCondition(new m.Condition(a,o,v))},setDataSource:function(d){if(d!==undefined&&d!==null){if(!(d instanceof m.DataSource)){d=new m.DataSource(d)}this.dataSource=d}return this},setSearchTerms:function(s){this.searchTerms=s},setJson:function(j){if(j.Selection===undefined){return}var a=new m.ConditionGroup();a.setJson(j);this.defaultConditionGroup.addCondition(a)}};m.Condition.prototype={init:function(a,o,v,b){if($.type(a)==='object'){var p=a;a=p.attribute;o=p.operator;v=p.value;b=p.operandType}this.attribute=a||"";this.operator=o||"=";this.value=v;this.operandType=b||'Member'},getJson:function(p){var o;if(this.operandType.toLowerCase()==='search'){o='SearchOperand'}else{o='MemberOperand'}var j={};j[o]={"AttributeName":this.attribute,"Comparison":this.operator,"Value":this.value};if(this.operator==='='&&this.value===null){j.MemberOperand.Comparison='IS NULL';j.MemberOperand.Value=''}p.push(j)},setJson:function(j){this.attribute=j.MemberOperand.AttributeName;this.operator=j.MemberOperand.Comparison;this.value=j.MemberOperand.Value;if(j.MemberOperand.Comparison==='IS NULL'&&j.MemberOperand.Value===''){this.operator='=';this.value=null}},toString:function(){return this.attribute+this.operator+this.value+''}};m.ConditionGroup.prototype={init:function(p){p=p||{};this.label=p.label||'';this.conditions=p.conditions||[];this.setOperator(p.operator||'And')},addCondition:function(c){this.conditions.push(c);return this},getConditions:function(){return this.conditions},getConditionsAsArray:function(a,c){c=c||[];a=a||this;for(var i=0;i<a.conditions.length;i++){if(a.conditions[i]instanceof m.ConditionGroup){this.getConditionsAsArray(a.conditions[i],c)}else{c.push(a.conditions[i])}}return c},removeCondition:function(c){this.conditions.splice(this.conditions.indexOf(c),1);return this},setLabel:function(l){this.label=l;return this},setOperator:function(o){switch(o.toLowerCase()){case'or':o='Or';break;case'and':o='And';break;default:throw{message:'unknown operator for condition group: '+o}}this.operator=o;return this},toString:function(){return this.label},getJson:function(p){if(this.conditions.length===0){return{}}var c=[];for(var i=0;i<this.conditions.length;++i){this.conditions[i].getJson(c)}var j={"Operator":{"Code":this.operator,"SubSelections":c}};if(p){p.push(j)}else{var r={Selection:j};return r}},setJson:function(j){if(j.Selection===undefined&&j.Operator){j.Selection={};j.Selection.Operator=j.Operator}this.setOperator(j.Selection.Operator.Code);var c=j.Selection.Operator.SubSelections;for(var i=0;i<c.length;i++){var a;if(c[i].Operator){a=new m.ConditionGroup()}else{a=new m.Condition()}a.setJson(c[i]);this.addCondition(a)}}}};if(typeof define==="function"&&define.amd){define(["jquery",'./jsontemplates'],function($){e($)})}else{e()}}(this));
/*
 * @file Simple info access (SINA) API: System representation
 * @ignore
 * @namespace sap.bc.ina.api.system
 * @copyright Copyright (c) 2013 SAP AG. All rights reserved.
 */
(function(g){"use strict";var e=function($){if(!$){$=g.$}g.sap=g.sap||{};g.sap.bc=g.sap.bc||{};g.sap.bc.ina=g.sap.bc.ina||{};g.sap.bc.ina.api=g.sap.bc.ina.api||{};g.sap.bc.ina.api.system=g.sap.bc.ina.api.system||{};var m=g.sap.bc.ina.api.system;m.System=function(){this.init.apply(this,arguments)};m.ABAPSystem=function(){this.init.apply(this,arguments)};m.HANASystem=function(){this.init.apply(this,arguments)};m.Service=function(){this.init.apply(this,arguments)};m.Capability=function(){this.init.apply(this,arguments)};var c=g.sap.bc.inauitk.config;m.Capability.prototype={init:function(p){this.properties=p||{};this.name=this.properties.Capability||"";this.minVersion=this.properties.MinVersion||0;this.maxVersion=this.properties.MaxVersion||0}};m.Service.prototype={init:function(p){this.properties=p||{};this.name=this.properties.Service;this.minVersion=this.properties.MinVersion||0;this.maxVersion=this.properties.MaxVersion||0;this.capabilities={};for(var i=0;i<this.properties.Capabilities.length;i++){this.capabilities[this.properties.Capabilities[i].Capability]=new m.Capability(this.properties.Capabilities[i])}},getCapability:function(n){return this.capabilities[n]},getCapabilities:function(){return this.capabilities}};m.System.prototype={init:function(p){this.properties=p||{};this.services={};this.proxy=p.proxy||new g.sap.bc.inauitk.Proxy()},getService:function(n){return this.services[n]},getServices:function(){return this.services},getSystemType:function(){return this.systemType},_getServerInfo:function(i){var s=this;if(s.jqXHR&&i===true){return s.jqXHR.promise()}s.jqXHR=jQuery.Deferred();var r={async:i,type:"GET",url:s.properties.infoUrl,processData:false,contentType:'application/json',dataType:'json'};s.proxy.ajax(r).done(function(d){s.setServerInfo(d);s.jqXHR.resolve(s.properties)});return s.properties},getServerInfo:function(){return this._getServerInfo(true)},getServerInfoSync:function(){return this._getServerInfo(false)},setServerInfo:function(j){this.properties.rawServerInfo=j;if(this instanceof m.ABAPSystem){if(!this.properties.sapclient){this.properties.sapclient=j.ServerInfo.Client}this.properties.dbms=j.ServerInfo.DataBaseManagementSystem;this.properties.dbmsVersion=j.ServerInfo.DataBaseManagementSystemVersion;if(this.properties.inaUrl.indexOf("sap-client")===-1&&this.properties.sapclient){if(this.properties.inaUrl.indexOf("?")===-1){this.properties.inaUrl=this.properties.inaUrl+"?sap-client="+this.properties.sapclient}else{this.properties.inaUrl=this.properties.inaUrl+"&sap-client="+this.properties.sapclient}if(this.properties.infoUrl.indexOf("?")===-1){this.properties.infoUrl=this.properties.infoUrl+"?sap-client="+this.properties.sapclient}else{this.properties.infoUrl=this.properties.infoUrl+"&sap-client="+this.properties.sapclient}}}for(var i=0;i<j.Services.length;i++){this.services[j.Services[i].Service]=new m.Service(j.Services[i])}}};m.ABAPSystem.prototype=$.extend({},m.System.prototype,{init:function(p){this.properties=p||{};m.System.prototype.init.apply(this,[this.properties]);this.systemType='ABAP';this.properties.inaUrl=this.properties.inaUrl||"/sap/es/ina/GetResponse";this.properties.infoUrl=this.properties.infoUrl||"/sap/es/ina/GetServerInfo";if(this.properties.sapclient){this.sapclient(this.properties.sapclient)}else{var s=this._readSapClientFromUrl();this.sapclient(s);if(!s){this.getServerInfoSync()}}var a=this._readSapLanguageFromUrl();if(a&&this.properties.inaUrl.indexOf("sap-client")===-1){if(this.properties.inaUrl.indexOf("?")===-1){this.properties.inaUrl=this.properties.inaUrl+"?sap-language="+a}else{this.properties.inaUrl=this.properties.inaUrl+"&sap-language="+a}}if(a&&this.properties.infoUrl.indexOf("sap-client")===-1){if(this.properties.infoUrl.indexOf("?")===-1){this.properties.infoUrl=this.properties.infoUrl+"?sap-language="+a}else{this.properties.infoUrl=this.properties.infoUrl+"&sap-language="+a}}},getUrlParameter:function(n){var s=location.search;var v=(new RegExp(n+'='+'(.+?)(&|$)').exec(s)||[null])[1];if(!v){return v}v=decodeURIComponent(v.replace(/\+/g," "));return v},_readSapClientFromUrl:function(){if(c&&c.noSapClientFromUrl===true){return""}return this.getUrlParameter("sap-client")},_readSapLanguageFromUrl:function(){return this.getUrlParameter("sap-language")},sapclient:function(s){if(s){this.properties.sapclient=s;this.properties.inaUrl=this.properties.inaUrl+"?sap-client="+this.properties.sapclient;this.properties.infoUrl=this.properties.infoUrl+"?sap-client="+this.properties.sapclient;this.getServerInfoSync()}else{return this.properties.sapclient}}});m.HANASystem.prototype=$.extend({},m.System.prototype,{init:function(p){this.properties=p||{};m.System.prototype.init.apply(this,[this.properties]);this.systemType='HANA';this.properties.infoUrl=this.properties.infoUrl||"/sap/bc/ina/service/v2/GetServerInfo";this.properties.inaUrl=this.properties.inaUrl||"/sap/bc/ina/service/v2/GetResponse";this._setUpAjaxErrorHandler();this.getServerInfo()},_setUpAjaxErrorHandler:function(){$(g.document).ajaxError(function(a,j,b,t){switch(j.status){case 401:g.window.location="/sap/hana/xs/formLogin/login.html?x-sap-origin-location="+encodeURIComponent(g.window.location.pathname)+encodeURIComponent(g.window.location.search);break;case 404:return}})}})};if(typeof define==="function"&&define.amd){define(["jquery"],function($){e($)})}else{e()}}(this));
/*
 * @file Simple info access (SINA) API: Implementation of the interface
 * @namespace sap.bc.ina.api.impl.inav2
 * @requires sap.bc.ina.api
 * @requires sap.bc.ina.api.impl.inav2.filter
 * @requires sap.bc.ina.api.impl.inav2.system
 * @requires jQuery
 * @copyright Copyright (c) 2013 SAP AG. All rights reserved.
 */
(function(g){"use strict";var e=function($){if(!$){$=g.$}g.sap=g.sap||{};g.sap.bc=g.sap.bc||{};g.sap.bc.ina=g.sap.bc.ina||{};g.sap.bc.inauitk=g.sap.bc.inauitk||{};g.sap.bc.ina.api=g.sap.bc.ina.api||{};g.sap.bc.ina.api.impl=g.sap.bc.ina.api.impl||{};g.sap.bc.ina.api.impl.inav2=g.sap.bc.ina.api.impl.inav2||{};g.sap.bc.ina.api.impl.inav2.Sina=function(){this.init.apply(this,arguments)};var f=g.sap.bc.ina.api.impl.inav2;f.Facet=function(){this.init.apply(this,arguments)};f.Perspective=function(){this.init.apply(this,arguments)};f.Query=function(){this.init.apply(this,arguments)};f.QueryBuilder=function(){this.init.apply(this,arguments)};f.CatalogQuery=function(){this.init.apply(this,arguments)};f.CatalogResultSet=function(){this.init.apply(this,arguments)};f.PerspectiveQuery=function(){this.init.apply(this,arguments)};f.Suggestion=function(){this.init.apply(this,arguments)};f.SuggestionQuery=function(){this.init.apply(this,arguments)};f.SuggestionResultSet=function(){this.init.apply(this,arguments)};f.Suggestion2Query=function(){this.init.apply(this,arguments)};f.Suggestion2ResultSet=function(){this.init.apply(this,arguments)};f.ChartQuery=function(){this.init.apply(this,arguments)};f.ChartResultSet=function(){this.init.apply(this,arguments)};f.GroupBarChartQuery=function(){this.init.apply(this,arguments)};f.GroupBarChartResultSet=function(){this.init.apply(this,arguments)};f.LineChartQuery=function(){this.init.apply(this,arguments)};f.LineChartResultSet=function(){this.init.apply(this,arguments)};f.SearchQuery=function(){this.init.apply(this,arguments)};f.SearchResultSet=function(){this.init.apply(this,arguments)};var h=g.sap.bc.ina.api.impl.inav2.jsontemplates;var p=g.sap.bc.ina.api.impl.inav2.filter;var s=g.sap.bc.ina.api.system;var q=g.sap.bc.inauitk.config;f.Condition=p.Condition;f.Sina.prototype={init:function(a){a=a||{};this.system(a.system||new s.HANASystem())},sapclient:function(a){var b;if(a){if(a<0){b=new s.HANASystem()}else{b=new s.ABAPSystem({"sapclient":a})}this.system(b)}else{return this.system().properties.sapclient()}},_registerPostProcessor:function(a){if(!this.postProcessor){this.postProcessor=[]}this.postProcessor.push(a)},_postprocess:function(a,b){if(this.postProcessor){for(var i=0;i<this.postProcessor.length;i++){this.postProcessor[i](a,b)}}},system:function(a){if(a){this.sys=a}else{return this.sys}},createChartQuery:function(a){a=a||{};a.system=a.system||this.system();return new f.ChartQuery(a)},createGroupBarChartQuery:function(a){a=a||{};a.system=a.system||this.system();return new f.GroupBarChartQuery(a)},createLineChartQuery:function(a){a=a||{};a.system=a.system||this.system();a.dimensions=[a.dimensionLine,a.dimensionX];a.measures=[{name:a.measureY.name,aggregationFunction:a.measureY.aggregationFunction}];return new f.LineChartQuery(a)},createSearchQuery:function(a){a=a||{};a.system=a.system||this.system();return new f.SearchQuery(a)},createSuggestionQuery:function(a){a=a||{};a.system=a.system||this.system();if(a.system instanceof s.ABAPSystem){return new f.Suggestion2Query(a)}if(a.system instanceof s.HANASystem){return new f.SuggestionQuery(a)}},createPerspectiveQuery:function(a){a=a||{};a.system=a.system||this.system();return new f.PerspectiveQuery(a)}};f.Query.prototype={init:function(a){a=a||{};this.system=a.system;this.onSuccess=a.onSuccess;this.onError=a.onError;this._responseJson=null;this.setTop(a.top||10);this.setSkip(a.skip||0);this.resultSet=a.resultSet||null;this.resultSetProperties=a;this.filterConditions=a.filterConditions||null;this.filter=a.filter||new p.Filter({dataSource:a.dataSource});this.setSearchTerms(a.searchTerms)},getDataSource:function(){return this.filter.getDataSource()},setDataSource:function(d){this.filter.setDataSource(d);this.resultSet=null;return this},getFilter:function(){return this.filter},setFilter:function(a){this.filter=a;this.resultSet=null;return this},setSearchTerms:function(t){this.filter.setSearchTerms(t);this.resultSet=null;return this},getSearchTerms:function(){return this.filter.getSearchTerms()},getSkip:function(){return this._skip},setSkip:function(a){this._skip=a;this.resultSet=null;return this},getTop:function(){return this._top},setTop:function(t){this._top=t;this.resultSet=null;return this},addFilterCondition:function(a,o,v){if(!(this.filter instanceof p.Filter)){this.filter=new p.Filter()}this.filter.addFilterCondition(a,o,v);this.resultSet=null;return this},removeFilterCondition:function(a,o,v){if(!(this.filter instanceof p.Filter)){this.filter=new p.Filter()}this.filter.removeFilterCondition(a,o,v);this.resultSet=null;return this},getResultSet:function(o,a){var b=this;o=o||b.onSuccess;a=a||b.onError;if(b.resultSet!==null){o(b.resultSet);return}var j=b.createJsonRequest();b._fireRequest(j,true,function(d){b._responseJson=d;if(d.error){a(d.error)}b.resultSet=new b.resultSetClass(b.resultSetProperties);b.resultSet.setJsonData(d);o(b.resultSet)},function(c){b._responseJson=c;if(a){a(c)}})},getResultSetSync:function(){var a=this;if(a.resultSet!==null){return a.resultSet}var j=a.createJsonRequest();var d=a._fireRequest(j,false);a._responseJson=d;a.resultSet=new a.resultSetClass(a.resultSetProperties);if(d&&d.responseText){var r=JSON.parse(d.responseText);a.resultSet.setJsonData(r)}return a.resultSet},_fireRequest:function(j,a,o,b){var r={async:a,url:this.system.properties.inaUrl,contentType:'application/json',dataType:'json',data:j};if(a){var c=this.system.proxy.ajax(r);if(b){c.fail(b)}if(o){c.done(o)}return}else{var d=this.system.proxy.ajax(r);return d}},_assembleOrderBy:function(){var o=[];function a(c,d){var i={};if(c.toLowerCase()==='$$score$$'){i.Function='Score'}else{i.AttributeName=c}i.SortOrder=d.toUpperCase();return i}var b;if($.type(this.orderBy)==='array'){for(var j=0;j<this.orderBy.length;j++){b=a(this.orderBy[j].orderBy,this.orderBy[j].sortOrder);o.push(b)}}else if($.type(this.orderBy)==='object'){b=a(this.orderBy.orderBy,this.orderBy.sortOrder);o.push(b)}return o}};f.QueryBuilder.prototype=$.extend({},f.Query.prototype,{init:function(a){f.Query.prototype.init.apply(this,[a])},dataSource:function(n){if(n){this.setDataSource(n);return this}else{return this.getDataSource()}},skip:function(n){if(n!==undefined){this._skip=n;this.resultSet=null}else{return this._skip}return this},top:function(n){if(n!==undefined){this._top=n;this.resultSet=null}else{return this._top}return this}});f.CatalogQuery.prototype=$.extend({},f.QueryBuilder.prototype,{init:function(a){a=a||{};f.QueryBuilder.prototype.init.apply(this,[a]);this.resultSetClass=f.SearchResultSet},createJsonRequest:function(){return h.catalogRequest}});f.Facet.prototype={init:function(a){a=a||{};this.title="";this.query=null;this.facetType=a.facetType.toLowerCase();if(this.facetType==='$$datasources$$'){this.facetType='datasource';this.query=new f.ChartQuery();this.query.resultSet=new f.ChartResultSet({"type":"datasource"})}else if(this.facetType!=='searchresult'){this.facetType='attribute';this.query=new f.ChartQuery();this.query.resultSet=new f.ChartResultSet()}else if(this.facetType==='searchresult'){this.query=new f.SearchQuery();this.query.resultSet=new f.SearchResultSet()}},getChartType:function(){},getTitle:function(){return this.title},getDimension:function(){return this.dimension},getQuery:function(){return this.query},getLayout:function(){},getLayoutBinding:function(){},getColorPalette:function(){},setJsonData:function(d){this.query.resultSet.setJsonData(d);this._parseServerSideFacetMetaData(d.Metadata)},_parseServerSideFacetMetaData:function(d){if(d&&d.Cube){this.title=d.Cube.Description;this.dimension=d.Cube.ObjectName}}};f.PerspectiveQuery.prototype=$.extend({},f.QueryBuilder.prototype,{init:function(a){var b=this;b.chartFacets=[];b.searchFacet=null;b.searchresultset=null;b.layout=null;b.templateFactsheet=a.templateFactsheet||false;a=a||{};f.QueryBuilder.prototype.init.apply(this,[a]);this.setOrderBy(a.orderBy);this.resultSetClass=f.Perspective},setOrderBy:function(o){this.resultSet=null;this.orderBy=o||{orderBy:'$$score$$',sortOrder:'DESC'}},createJsonRequest:function(){if(this.templateFactsheet){h.perspectiveRequest=h.perspectiveRequestFactsheet}h.perspectiveRequest.DataSource=this.filter.dataSource.toInAJson();var a=this.filter.getSearchTerms();h.perspectiveRequest.Search.SearchTerms=a;if(q&&q.startWithSearch!==undefined&&q.startWithSearch==='false'){if(!a&&this.filter.dataSource.getObjectName().value.toLowerCase()==='$$all$$'){var c=new f.CatalogQuery();return c.createJsonRequest()}}h.perspectiveRequest.Search.Top=this._top;h.perspectiveRequest.Search.Skip=this._skip;h.perspectiveRequest.Search.Filter=this.filter.getJson();h.perspectiveRequest.Search.OrderBy=this._assembleOrderBy();return h.perspectiveRequest},getPerspective:function(o,a){this.getResultSet(o,a)},generatePerspectiveSync:function(){return this.getResultSetSync()}});f.Perspective.prototype={init:function(a){var b=this;b.chartFacets=[];b.searchFacet=null;b.searchresultset=null;b.layout=null;a=a||{}},getSearchResultSet:function(){return this.searchresultset},getChartFacets:function(){return this.chartFacets},getSearchFacet:function(){return this.searchFacet},getLayout:function(){return this.layout},setJsonData:function(d){var a=this;a.searchFacet=new f.Facet({"facetType":"searchresult"});a.searchFacet.setJsonData(d);a.searchresultset=a.searchFacet.getQuery().getResultSetSync();if(d.ResultsetFacets&&d.ResultsetFacets.Elements){for(var j=0;j<d.ResultsetFacets.Elements.length;j++){var b=new f.Facet({"facetType":d.ResultsetFacets.Elements[j].Metadata.Cube.ObjectName});b.setJsonData(d.ResultsetFacets.Elements[j]);a.chartFacets.push(b)}}else{var c=new f.Facet({facetType:'$$datasources$$'});for(var i=0;i<a.searchFacet.getQuery().getResultSetSync().getElements().length;i++){var k=new p.DataSource();var r=a.searchFacet.getQuery().getResultSetSync().getElements()[i];k.setObjectName(r.ObjectName.valueRaw);k.setPackageName(r.PackageName.valueRaw);k.setSchemaName(r.SchemaName.valueRaw);k.setType(r.Type.valueRaw);k.setLabel(r.Description.value);c.getQuery().getResultSetSync().getElements()[i]={dataSource:k}}a.searchFacet.getQuery().getResultSetSync().elements=[];a.searchFacet.getQuery().getResultSetSync().totalcount=-1;a.chartFacets.push(c)}}};f.SuggestionQuery.prototype=$.extend({},f.QueryBuilder.prototype,{init:function(a){a=a||{};this.attributes=a.attributes||[];f.QueryBuilder.prototype.init.apply(this,[a]);this.resultSetClass=f.SuggestionResultSet},addResponseAttribute:function(a){this.attributes.push(a);this.resultSet=null;return this},setResponseAttributes:function(a){this.attributes=a;this.resultSet=null;return this},createJsonRequest:function(){h.suggestionRequest.Suggestions.Precalculated=false;var a=this.filter.getSearchTerms();if(this.attributes.length===0){throw"add at least one response attribute to your query"}if(a.charAt(a.length-1)!=='*'){a+='*'}h.suggestionRequest.Suggestions.SearchTerms=a;h.suggestionRequest.Suggestions.AttributeNames=this.attributes;h.suggestionRequest.DataSource=this.filter.dataSource.toInAJson();h.suggestionRequest.Suggestions.Top=this._top;return h.suggestionRequest}});f.SuggestionResultSet.prototype={init:function(){this.suggestions=[]},setJsonData:function(c){this.suggestions=[];var j={};for(var i=0;i<c.ItemLists.length;i++){j[c.ItemLists[i].Name]=c.ItemLists[i]}for(var a=0;a<j.Suggestions.Items.length;a++){var k=j.Suggestions.Items[a],t="",l="",m="";var n={};for(var d=0;d<k.NamedValues.length;++d){var r=k.NamedValues[d];switch(r.Name){case"Term":t=r.Value;n.label=t;break;case"AttributeName":l=r.Value;n.attribute=l;break;case"$$AttributeDescription$$":m=r.Value;n.attributeDescription=m;break;case"Score":var u=r.Value;n.score=parseInt(u,10);break}}this.suggestions.push(n)}this.suggestions.sort(function(a,b){return b.score-a.score});for(var o=this.suggestions.length-1;o>=0;o--){delete this.suggestions[o].score}},getElements:function(){return this.suggestions}};f.Suggestion2Query.prototype=$.extend({},f.QueryBuilder.prototype,{init:function(a){a=a||{};this.attributes=a.attributes||[];f.QueryBuilder.prototype.init.apply(this,[a]);this.resultSetClass=f.Suggestion2ResultSet;this.searchTerms=a.searchTerms||{};this.suggestionTerm=a.suggestionTerm||''},addResponseAttribute:function(a){this.attributes.push(a);this.resultSet=null;return this},addSearchTerm:function(t){if(t){this.searchTerms[t]=t}this.resultSet=null;return this},setSuggestionTerm:function(t){if(t.charAt(t.length-1)!=='*'){t+='*'}this.suggestionTerm=t;this.resultSet=null;return this},setResponseAttributes:function(a){this.attributes=a;this.resultSet=null;return this},createJsonRequest:function(){h.suggestion2Request.Suggestions2.Precalculated=false;h.suggestion2Request.Suggestions2.NamedValues=[];for(var i=0;i<this.attributes.length;i++){h.suggestion2Request.Suggestions2.NamedValues.push({AttributeName:this.attributes[i],Name:this.attributes[i]})}h.suggestion2Request.DataSource=this.filter.dataSource.toInAJson();h.suggestion2Request.Suggestions2.Top=this.getTop();h.suggestion2Request.Suggestions2.Skip=this.getSkip();var r=new p.ConditionGroup();var a=new p.ConditionGroup();for(var b in this.searchTerms){var c=new p.Condition('$$SearchTerms$$','=',b,'search');r.addCondition(c)}var d=new p.Condition('$$SuggestionTerms$$','=',this.suggestionTerm,'search');r.addCondition(d);r.addCondition(this.getFilter().getFilterConditions());h.suggestion2Request.Suggestions2.Filter=r.getJson();return h.suggestion2Request}});f.Suggestion2ResultSet.prototype={init:function(){this.datasources={};this.suggestions=[]},setJsonData:function(b){this.datasources={};this.suggestions=[];function k(I){switch(I){case"Value1":case"Value2":case"Order":return false;default:return true}}var l={};if(!b.ItemLists){return}for(var i=0;i<b.ItemLists.length;i++){l[b.ItemLists[i].Name]=b.ItemLists[i]}for(var a=0;a<b.Grids.length;a++){var m=b.Grids[a].Axes;var n=b.Grids[a].Cells;if(m===undefined||n===undefined){return}var o={};for(var r=0;r<n.length;++r){var t=n[r],u="",v="",w="",x={};x.dataSource=new p.DataSource();x.attribute={};for(var j=0;j<t.Index.length;j++){var y=t.Index[j];var z=m[j].Tuples[y];if(z===undefined){continue}for(var c=0;c<z.length;c++){var A=m[j].Dimensions[c];var B=z[c];var C=l[A.ItemListName];var D=C.Items[B].NamedValues;for(var d=0;d<D.length;++d){var E=D[d];switch(E.Name){case"$$Term$$":x.valueRaw=t.Value||t.ValueFormatted||null;x.value=t.ValueFormatted||t.Value||null;x.labelRaw=E.Value;x.label=E.ValueFormatted;if(!x.filter){x.filter={}}x.filter.value=x.labelRaw;x.filter.valueLabel=x.labelRaw;break;case"$$DataSource$$":var F=E.Value;x.dataSource.setObjectNameValue(F);break;case"$$DataSourceDescription$$":var G=E.Value;x.dataSource.setObjectNameLabel(G);break;case"$$Attribute$$":var H=E.Value;if(!x.filter){x.filter={}}x.filter.attribute=H;x.attribute.value=H;break;case"$$AttributeDescription$$":v=E.Value;if(!x.filter){x.filter={}}x.filter.attributeLabel=v;x.attribute.label=v;break}}}}this.suggestions.push(x)}}},getElements:function(){return this.suggestions}};f.ChartQuery.prototype=$.extend({},f.QueryBuilder.prototype,{init:function(a){a=a||{};f.QueryBuilder.prototype.init.apply(this,[a]);this.dimensions={};this.dimensions.CustomDimension1={Axis:"Columns",Name:"CustomDimension1",Members:[]};a.dimensions=a.dimensions||{};if($.type(a.dimensions)==='array'){for(var i=0;i<a.dimensions.length;i++){this.addDimension(a.dimensions[i])}}else if($.type(a.dimensions)==='string'||$.type(a.dimensions)==='object'){this.addDimension(a.dimensions)}a.measures=a.measures||{};if($.type(a.measures)==='array'){for(var j=0;j<a.measures.length;j++){this.addMeasure(a.measures[j])}}else if($.type(a.measures)==='object'){this.addMeasure(a.measures)}this.resultSetClass=f.ChartResultSet},createJsonRequest:function(){h.chartRequest.DataSource=this.filter.dataSource.toInAJson();h.chartRequest.SearchTerms=this.filter.getSearchTerms();h.chartRequest.Analytics.Definition.Filter=this.filter.getJson();h.chartRequest.Analytics.Definition.Dimensions=[];for(var d in this.dimensions){h.chartRequest.Analytics.Definition.Dimensions.push(this.dimensions[d])}return h.chartRequest},count:function(d){this.addMeasure({name:d,aggregationFunction:'COUNT'});return this},addMeasure:function(a){if($.isEmptyObject(a)){return}var b="Columns";var n="CustomDimension1";var m;if(a.aggregationFunction.toUpperCase()==='COUNT'||a.aggregationFunction.toUpperCase()==='AVG'){m=this._createAggregationDimension(a.aggregationFunction,a.name,a.aggregationFunction,a.sortOrder,a.top)}else{m=this._createAggregationDimension(a.aggregationFunction,"",a.name,a.sortOrder,a.top);delete m.AggregationDimension;delete m.Name;delete m.SortOrder}this.dimensions.CustomDimension1.Members.push(m);return this},addDimension:function(d,a,t){if($.type(d)==='object'){if($.isEmptyObject(d)){return}this.dimensions[d.name]=this._createDimension(d.name,null,d.sortOrder,d.top)}else if($.type(d)==='string'){if(!d){return}this.dimensions[d]=this._createDimension(d,null,a,t)}return this},_createDimension:function(d,a,b,t){return{"Axis":a||"Rows","Name":d,"SortOrder":b||1,"Top":t||5}},_createAggregationDimension:function(a,b,n,c,t){return{"Aggregation":a,"AggregationDimension":b,"MemberOperand":{"AttributeName":"Measures","Comparison":"=","Value":n},"Name":n,"SortOrder":c||2}}});f.ChartResultSet.prototype={init:function(a){a=a||{};this.type=a.type;this.elements=[]},_parseNamedValues:function(a,n,m){var b=this;for(var i=0;i<n.length;i++){var c=n[i].Name;var v=n[i].Value;a.label=n[i].ValueFormatted;a.labelRaw=n[i].Value;switch(c){case'$$DataSource$$':b._parseNamedValuesForDataSource(a,v);break;case'$$AttributeValue$$':b._parseNamedValuesForRange(a,v,m);break}}},_parseNamedValuesForRange:function(a,v,m){var b,c,i;for(var d=0;d<v.length;++d){var n=v[d];switch(n.Name){case"ValueID":a.label=n.ValueFormatted;b=n.Value;break;case"Value1":if(m.Cube.ObjectName&&(n.Value!==undefined)){c=new p.Condition(m.Cube.ObjectName,">=",n.Value)}break;case"Value2":if(m.Cube.ObjectName&&(n.Value!==undefined)){i=new p.Condition(m.Cube.ObjectName,"<=",n.Value)}break;case"Order":break}}if(b){if(c&&i){var j=new p.ConditionGroup();j.setOperator("AND");j.setLabel(a.label);if(c.value){j.addCondition(c)}if(i.value){j.addCondition(i)}a.labelRaw=j}else if(c&&c.value&&(!i)){c.operator='=';a.labelRaw=c}else if(i&&i.value&&(!c)){i.operator='=';a.labelRaw=i}}},_parseNamedValuesForDataSource:function(a,v){a.dataSource=new p.DataSource();for(var d=0;d<v.length;++d){var n=v[d];switch(n.Name){case"ObjectName":var l=n.ValueFormatted;a.dataSource.setLabel(l);a.dataSource.setObjectName(n.Value,n.ValueFormatted);break;case"PackageName":a.dataSource.setPackageName(n.Value,n.ValueFormatted);break;case"SchemaName":a.dataSource.setSchemaName(n.Value,n.ValueFormatted);break;case"Type":a.dataSource.setType(n.Value,n.ValueFormatted);break;default:a[n.Name]=n.Value;break}}},setJsonData:function(d){this.elements=[];var m;if(d.Metadata){m=d.Metadata}if(d.ResultSet){d=d.ResultSet}var b={};for(var i=0;i<d.ItemLists.length;i++){b[d.ItemLists[i].Name]=d.ItemLists[i]}for(var a=0;a<d.Grids.length;a++){var k=d.Grids[a].Axes;var l=d.Grids[a].Cells;for(var n=0;n<l.length;++n){if(k[0].Dimensions.length===1){var o=l[n];var r={valueRaw:o.Value||o.ValueFormatted||null,value:o.ValueFormatted||o.Value||null};for(var j=0;j<1;j++){var t=o.Index[j];var u=k[j].Tuples[t];if(u===undefined){continue}for(var c=0;c<u.length;c++){var v=k[j].Dimensions[c];var w=u[c];var x=b[v.ItemListName];var y=x.Items[w].NamedValues;this._parseNamedValues(r,y,m)}}this.elements.push(r)}}}},getElements:function(){return this.elements}};var R=function(){this.init.apply(this,arguments)};R.prototype={init:function(o){this.resultSet=o.resultSet;this.parse()},parse:function(){this.enhance(this.resultSet);var a=this.resultSet.Grids[0];var r=a.Axes[0];var c=a.Axes[1];var k=function(v){return v.NamedValues[0].Value};var t=new T({keyFunction:k});for(var i=0;i<a.Cells.length;++i){var b=a.Cells[i];var d=b.Index[0];var j=this.resolve(r,d);var l=j.map(k);var m=b.Index[1];var n=this.resolve(c,m);var o=n.map(k);n=[$.extend({},n[0])];n[0].cell=b;var u=j;u.push.apply(u,n);t.insert(u)}return t},resolve:function(a,b){var c=[];var t=a.Tuples[b];for(var i=0;i<t.length;++i){var d=t[i];var j=a.Dimensions[i].ItemList.Items[d];c.push(j)}return c},enhance:function(r){var a={};for(var i=0;i<r.ItemLists.length;++i){var b=r.ItemLists[i];a[b.Name]=b}for(i=0;i<r.Grids.length;++i){var c=r.Grids[i];for(var j=0;j<c.Axes.length;++j){var d=c.Axes[j];for(var k=0;k<d.Dimensions.length;++k){var l=d.Dimensions[k];l.ItemList=a[l.ItemListName]}}}}};var T=function(){this.init.apply(this,arguments)};T.prototype={init:function(o){this.root={data:"root",subTree:{}};if(o&&o.keyFunction){this.keyFunction=o.keyFunction}else{this.keyFunction=function(a){return a}}},insert:function(a){var b=this.root;for(var i=0;i<a.length;++i){var c=a[i];var k=this.keyFunction(c);if(!b.subTree.hasOwnProperty(k)){b.subTree[k]={subTree:{},data:c}}b=b.subTree[k]}},toString:function(){var a=[];this.toStringHelper(this.root,[],a);return a.join("")},toStringHelper:function(t,a,b){var c=null;if(t===this.root){c=t.data}else{c=this.keyFunction(t.data)}a.push(c);var d=false;for(var i in t.subTree){if(t.subTree.hasOwnProperty(i)){d=true;var j=t.subTree[i];var k=a.slice(0);this.toStringHelper(j,k,b)}}if(!d){b.push(a.toString()+"\n")}}};f.GroupBarChartQuery.prototype=$.extend({},f.ChartQuery.prototype,{init:function(a){a=a||{};f.ChartQuery.prototype.init.apply(this,[a]);this.resultSetClass=f.GroupBarChartResultSet}});f.GroupBarChartResultSet.prototype={init:function(a){a=a||{};this.elements=[]},setJsonData:function(d){var a=this;this.elements=[];var r=new R({resultSet:d});var t=r.parse();function b(c,i){for(var j in c){var k=c[j];var l={label:k.data.NamedValues[0].ValueFormatted,value:[]};if(k.data.cell){l.value={value:k.data.cell.ValueFormatted,valueRaw:k.data.cell.Value}}if(i){i.value.push(l)}else{a.elements.push(l)}if(k.subTree){b(k.subTree,l)}}}b(t.root.subTree)},getElements:function(){return this.elements}};f.LineChartQuery.prototype=$.extend({},f.ChartQuery.prototype,{init:function(a){a=a||{};f.ChartQuery.prototype.init.apply(this,[a]);this.resultSetClass=f.LineChartResultSet}});f.LineChartResultSet.prototype=$.extend({},f.GroupBarChartResultSet.prototype,{init:function(a){a=a||{};this.elements=[]},setJsonData:function(d){var a=this;this.elements=[];var r=new R({resultSet:d});var t=r.parse();function b(c,i){for(var j in c){var k=c[j];var l={label:k.data.NamedValues[0].ValueFormatted,value:[]};for(var m in k.subTree){var n=k.subTree[m];var o={x:n.data.NamedValues[0].ValueFormatted};for(var u in n.subTree){var v=n.subTree[u];o.y=v.data.cell.Value}l.value.push(o)}a.elements.push(l)}}b(t.root.subTree)},getElements:function(){return this.elements}});f.SearchQuery.prototype=$.extend({},f.QueryBuilder.prototype,{init:function(a){a=a||{};f.QueryBuilder.prototype.init.apply(this,[a]);this.sqlSearch=(a.sqlSearch===undefined||a.sqlSearch===true)?true:false;this.attributes=a.attributes||[];this.setOrderBy(a.orderBy);this.resultSetClass=f.SearchResultSet},addResponseAttribute:function(a){this.attributes.push(a);this.resultSet=null;return this},createJsonRequest:function(){var a=this;h.searchRequest.DataSource=this.filter.dataSource.toInAJson();if(this.system instanceof s.HANASystem){if(this.attributes.length===0){throw{message:"Add at least one response attribute to your query"}}if(this.sqlSearch===true){h.searchRequest.Options=["SqlSearch"]}}var b=[];for(var i=0;i<this.attributes.length;++i){var c=this.attributes[i];if($.type(c)==='string'){b.push({Name:c,AttributeName:c})}else if($.type(c)==='object'){var d={Name:c.name||c.attributeName,AttributeName:c.attributeName||c.name};if(c.highlighted===true){d.Function='Highlighted'}if(c.snippet===true){d.Function='Snippet'}if(c.startPosition!==undefined){d.StartPosition=c.startPosition}if(c.maxLength!==undefined){d.MaxLength=c.maxLength}b.push(d)}}h.searchRequest.Search.SelectedValues=b;var j=this.filter.getSearchTerms();if(!j){j='*'}h.searchRequest.SearchTerms=j;h.searchRequest.Search.Top=this._top;h.searchRequest.Search.Skip=this._skip;h.searchRequest.Search.Filter=this.filter.getJson();h.searchRequest.Search.OrderBy=this._assembleOrderBy();return h.searchRequest},setOrderBy:function(o){this.resultSet=null;this.orderBy=o||{orderBy:'$$score$$',sortOrder:'DESC'}}});f.SearchResultSet.prototype={init:function(a){a=a||{};this.elements=[];this.totalcount=0},setJsonData:function(d){this.elements=[];function a(){this.type="";this.platform="";this.technology="";this.width="";this.height="";this.variant="";this.uri=""}a.prototype={_fromInaJson:function(k){this.type=k.Type||"";this.platform=k.Platform||"";this.technology=k.Technology||"";this.width=k.Width||"";this.height=k.Height||"";this.variant=k.Variant||"";this.uri=k.Uri||""}};function b(){this.type="";this.description="";this.uri="";this.request=null;this.encodedJSON=""}b.prototype={_fromInaJson:function(k){var l=this;l.description=k.Description;l.uri=k.Uri;switch(k.Type){case"RelatedRequest":l.type='Search';var m={};m.dataSource=new p.DataSource();m.dataSource.fromInAJson(k.Request.DataSource);m.system=g.sap.bc.ina.api.sina.system();m.top=1;l.request=new f.SearchQuery(m);l.request.filter.setJson(k.Request.Filter);if(k.Request.Filter.Selection===undefined){l.request.invalid=true;l.request.invalidMessage="Related request '"+l.description+"' is invalid because of missing filter conditions."}break;case"GeneralUri":l.type='Link';l.url=l.uri;break;case"SAPNavigation":l.type='Navigation';l.url=l.uri;break}l.encodedJSON=encodeURIComponent(l)}};function r(k){this.resultElementAttribute=k;this.correspondingSearchAttributeName="";this.description="";this.isTitle=false;this.presentationUsage=[];this.displayOrder=null}r.prototype={_fromInaJson:function(k){var l=this;l.correspondingSearchAttributeName=k.correspondingSearchAttributeName||"";l.description=k.Description||"";l.presentationUsage=k.presentationUsage||[];if(k.IsTitle!==undefined){l.isTitle=k.IsTitle}if(l.isTitle){if(!l.resultElementAttribute.resultElement.title){l.resultElementAttribute.resultElement.title=l.resultElementAttribute.resultElement.$$DataSourceMetaData$$.getLabel()+":"}l.resultElementAttribute.resultElement._registerPostProcessor(function(){l.resultElementAttribute.resultElement.title=l.resultElementAttribute.resultElement.title+" "+l.resultElementAttribute.value})}}};function t(k){this.resultElement=k;this.$$MetaData$$=new r(this);this.label="";this.labelRaw="";this.value="";this.valueRaw=""}t.prototype={_fromInaJson:function(k){var l=this;l.labelRaw=this.$$MetaData$$.correspondingSearchAttributeName||k.Name||"";l.label=this.$$MetaData$$.description||k.Name||"";l.valueRaw=k.Value||null;l.value=k.ValueFormatted||null},toString:function(){return this.value}};function u(){this.title="";this.$$DataSourceMetaData$$={};this.$$RelatedActions$$={};this.$$RenderingTemplateSpecification$$={};this.$$WhyFound$$=[];this.$$PostProcessors$$=[]}u.prototype={_fromInaJson:function(D){var F=this;for(var k=0;k<D.length;++k){var G=D[k];switch(G.Name){case"$$DataSourceMetaData$$":var H=G.Value[0];var I=new p.DataSource(H);F.$$DataSourceMetaData$$=I;break;case"$$AttributeMetadata$$":for(var m=0;m<G.Value.length;++m){var J=G.Value[m];if(!F[J.Name]){F[J.Name]=new t(F)}F[J.Name].$$MetaData$$._fromInaJson(J);F[J.Name].$$MetaData$$.displayOrder=m}break;case"$$ResultItemAttributes$$":for(var l=0;l<G.Value.length;++l){var K=G.Value[l];if(!F[K.Name]){F[K.Name]=new t(F)}F[K.Name]._fromInaJson(K)}break;case"$$RelatedActions$$":var L={};for(var n=0;n<G.Value.length;++n){var M=G.Value[n];var N=new b();N._fromInaJson(M);L[M.ID]=N}F.$$RelatedActions$$=L;break;case"$$RenderingTemplateSpecification$$":for(var o=0;o<G.Value.length;++o){var O=new a();O._fromInaJson(G.Value[o]);if(O.type==="ItemDetails"){F._detailTemplate=O}else{F.$$RenderingTemplateSpecification$$=O}}break;case"$$WhyFound$$":for(var z=0;z<G.Value.length;++z){var P={};P.label=G.Value[z].Description;P.labelRaw=G.Value[z].Name;P.value=G.Value[z].Value;P.valueHighlighted=P.value;P.valueRaw=G.Value[z].Value;F.$$WhyFound$$.push(P)}break;default:F[G.Name]=new t();F[G.Name].label=G.Name||"";F[G.Name].valueRaw=G.Value||G.ValueFormatted||null;F[G.Name].value=G.ValueFormatted||G.Value||null}}for(var i=0;i<this.$$PostProcessors$$.length;i++){this.$$PostProcessors$$[i]()}},_registerPostProcessor:function(k){this.$$PostProcessors$$.push(k)}};function _(y){if(y._detailTemplate&&!y.$$RelatedActions$$.$$DETAILS$$){y.$$RelatedActions$$.$$DETAILS$$={request:new f.SearchQuery(),description:'',encodedJSON:'',type:'Search',uri:''}}if(y._detailTemplate&&y.$$RelatedActions$$.$$DETAILS$$){var k=new f.SearchResultSet();k.elements[0]=$.extend(true,{},y);k.elements[0].$$RenderingTemplateSpecification$$=y._detailTemplate;k.totalcount=1;delete k.elements[0].$$RelatedActions$$.$$DETAILS$$;y.$$RelatedActions$$.$$DETAILS$$.request.resultSet=k;return k.elements[0]}}var v={};if(!d.ItemLists){return}for(var i=0;i<d.ItemLists.length;i++){v[d.ItemLists[i].Name]=d.ItemLists[i];if(d.ItemLists[i].Name.toLowerCase()==="searchresult"){this.totalcount=d.ItemLists[i].TotalCount.Value}}var w;if(d&&d.Grids&&d.Grids[0]&&d.Grids[0].Axes&&d.Grids[0].Axes[0]){w=d.Grids[0].Axes[0]}else{return}for(var j=0;j<w.Tuples.length;j++){var x=w.Tuples[j];if(x===undefined){continue}var y=new u();for(var c=x.length-1;c>=0;c--){var A=w.Dimensions[c];var B=x[c];var C=v[A.ItemListName];var D=C.Items[B].NamedValues;y._fromInaJson(D)}if(v&&v.$$MetaData$$&&v.$$MetaData$$.Items[0]&&v.$$MetaData$$.Items[0].NamedValues[2]&&v.$$MetaData$$.Items[0].NamedValues[2].Value){y=this._postProcess4WhyFound(y,v.$$MetaData$$.Items[0].NamedValues[2].Value)}var E=_(y);this._postProcessRelatedAction(y);if(E){this._postProcessRelatedAction(E)}this.elements.push(y)}},getElements:function(){return this.elements},_postProcessRelatedAction:function(a){for(var r in a.$$RelatedActions$$){var b=a.$$RelatedActions$$[r];if(b.type==="Search"){g.sap.bc.ina.api.sina._postprocess(b,a.title)}}},_postProcess4WhyFound:function(a,m){if(a.$$WhyFound$$&&a.$$WhyFound$$.length>0){var i=a.$$WhyFound$$.length;var v;var b;while(i--){b=false;if(a[a.$$WhyFound$$[i].labelRaw]!==undefined&&m!==undefined){var j=m.length;while(j--){if(m[j].Name===a.$$WhyFound$$[i].labelRaw&&m[j].correspondingSearchAttributeName){a.$$WhyFound$$[i].labelRaw=m[j].correspondingSearchAttributeName;b=true}}}}}return a}}};if(typeof define==="function"&&define.amd){define(["jquery","./system","./filter","./jsontemplates"],function($){e($)})}else{e()}}(window));
/*
 * @file Simple info access (SINA) API: Factory
 * @namespace sap.bc.ina.api
 * @requires jQuery
 * @copyright Copyright (c) 2013 SAP AG. All rights reserved.
 */
(function(g){"use strict";var e=function(){g.sap=g.sap||{};g.sap.bc=g.sap.bc||{};g.sap.bc.ina=g.sap.bc.ina||{};g.sap.bc.ina.api=g.sap.bc.ina.api||{};g.sap.bc.ina.api.impl=g.sap.bc.ina.api.impl||{};var a=g.sap.bc.ina.api;var c=g.sap.bc.inauitk.config;var i=g.sap.bc.inauitk;var s=g.sap.bc.ina.api.system;g.sap.bc.ina.api.SINA_TYPE_INAV2="inav2";g.sap.bc.ina.api.SINA_TYPE_INAV2_IMPL=g.sap.bc.ina.api.impl.inav2.Sina;g.sap.bc.ina.api.getSina=function(h){h=h||{};h.impl_type=h.impl_type||a.SINA_TYPE_INAV2;if(h.impl_type===a.SINA_TYPE_INAV2){return new a.SINA_TYPE_INAV2_IMPL(h)}else{throw"Unknown SINA_TYPE:'"+h.impl_type+"' (use sap.bc.ina.api.SINA_TYPE_INAV2)"}};var b={};if(i&&c){var p,d;if(c){p={httpMethod:c.hasOwnProperty("get")?"Get":c.httpMethod,cachelifetime:c.cachelifetime}}var f=new i.Proxy(p);if(c.systemType&&c.systemType.toUpperCase()==="ABAP"){d=new s.ABAPSystem({'proxy':f})}else{d=new s.HANASystem({'proxy':f})}b.system=d}g.sap.bc.ina.api.sina=g.sap.bc.ina.api.getSina(b);return g.sap.bc.ina.api.sina};if(typeof define==="function"&&define.amd){define(["./impl/inav2/filter","./impl/inav2/sina_impl","./impl/inav2/system","./impl/inav2/proxy","./impl/inav2/jsontemplates"],function(){var s=e();s.filter=g.sap.bc.ina.api.impl.inav2.filter;s.systems=g.sap.bc.ina.api.system;return s})}else{e()}}(window));
