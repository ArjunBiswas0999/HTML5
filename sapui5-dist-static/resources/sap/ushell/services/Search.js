// Copyright (c) 2013 SAP AG, All Rights Reserved
(function(){"use strict";jQuery.sap.declare("sap.ushell.services.Search");sap.ushell.services.Search=function(a,c){var C,o,l=sap.ushell.Container.getService("LaunchPage");this.init=function(){};this.isSearchAvailable=function(){return a.isSearchAvailable()};var _=function(){var d=jQuery.Deferred();if(C){if(o.isResolved()){d.resolve(C)}else{o.done(function(){d.resolve(C)})}}else{C=[];o=d;l.getCatalogs().done(function(b){var D=[];for(var i=0;i<b.length;i++){D.push(l.getCatalogTiles(b[i]))}jQuery.when.apply(jQuery,D).done(function(){var t=arguments;for(var i=0;i<t.length;i++){var T=t[i];for(var j=0;j<T.length;j++){var e=T[j],f=l.getCatalogTileView(e),k=l.getCatalogTileKeywords(e),s=l.getCatalogTileTargetURL(e),g=l.getCatalogTilePreviewTitle(e)||l.getCatalogTileTitle(e),S=l.getCatalogTileSize(e),I=l.getCatalogTilePreviewIcon(e)||"sap-icon://business-objects-experience";C.push({tile:e,keywords:k,url:s,title:g,icon:I,size:S});f.destroy()}}d.resolve(C)})})}return d.promise()};this.queryApplicationsByTarget=function(s,r){_().done(function(C){var R=[];for(var j=0,L=s&&s.length||0;j<L;j++){var S=s[j],u=sap.ushell.Container.getService("URLParsing");for(var i=0;i<C.length;i++){var t=u.parseShellHash(C[i].url);if(t&&(t.semanticObject===S.semanticObject)&&(t.action===S.action)){R.push(C[i]);break}}}r(R)})};this.queryApplications=function(s,r,t){var b=s,m=function(f,e){return{totalResults:e,searchTerm:b,getElements:function(){return f}}};s=new RegExp(s.replace("*",".*"),"gi");var d=function(C){var f=[],T,e,g,I,k,K,L,F,h=0;t=t||C.length;for(var j=0;j<C.length;j++){T=C[j];g=T.title;I=T.icon;k=T.keywords;F=false;for(var i=0;!F&&i<k.length;i++){K=k[i];if(s.test(K)){h=h+1;if(f.length<t){L=K.replace(s,"<b>$&</b>");e={tile:T.tile,label:L,title:g,icon:I,targetURL:T.url,size:T.size};f.push(e);F=true}}}}r(m(f,h))};_().done(function(e){d(e)})};this.querySuggestions=function(s,r){return a.querySuggestions(s,function(b){b.searchTerm=s;r(b)})};this.search=function(s,r){return a.search(s,r)};this.searchWithCategories=function(s,d,m,r,t,b){return a.searchWithCategories(s,d,m,r,t,b)};this.searchInit=function(){return a.searchInit()};this.setQueryForAll=function(m,f){return a.setQueryForAll(m,f)};this.setSearchTermWithoutQuery=function(s){return a.setSearchTermWithoutQuery(s)};this.searchFireQuery=function(m){return a.searchFireQuery(m)};this.searchAppendNextPage=function(m){return a.searchAppendNextPage(m)};this.setDataSource=function(d,m){return a.setDataSource(d,m)};this.setSearchCategoryTree=function(b){return a.setSearchCategoryTree(b)};this.getSina=function(){return a.getSina()};this.getDataSource=function(){return a.getDataSource()}}}());
