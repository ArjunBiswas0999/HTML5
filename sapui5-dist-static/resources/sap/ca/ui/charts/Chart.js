/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright
 * 		2009-2012 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.ca.ui.charts.Chart");jQuery.sap.require("sap.ca.ui.library");jQuery.sap.require("sap.ui.core.Control");sap.ui.core.Control.extend("sap.ca.ui.charts.Chart",{metadata:{library:"sap.ca.ui",properties:{"width":{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:'100%'},"height":{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:'100%'},"dataset":{type:"object",group:"Data",defaultValue:null},"chartType":{type:"string",group:"Data",defaultValue:'Bar'},"minShapeSize":{type:"sap.ui.core.CSSSize",group:"Data",defaultValue:'48px'},"label":{type:"string",group:"Data",defaultValue:''},"title":{type:"string",group:"Appearance",defaultValue:'Chart'},"icon":{type:"string",group:"Appearance",defaultValue:''},"secondAxisVisible":{type:"boolean",group:"Appearance",defaultValue:true},"showLegend":{type:"boolean",group:"Behavior",defaultValue:true},"selectionMode":{type:"sap.ca.ui.charts.ChartSelectionMode",group:"Behavior",defaultValue:sap.ca.ui.charts.ChartSelectionMode.Multiple},"showHoverBackground":{type:"boolean",group:"Behavior",defaultValue:false},"showTooltip":{type:"boolean",group:"Behavior",defaultValue:false},"showPopover":{type:"boolean",group:"Behavior",defaultValue:true},"showDataLabel":{type:"boolean",group:"Behavior",defaultValue:true},"yAxisLabelFormatter":{type:"string",group:"Data",defaultValue:null},"yAxis2LabelFormatter":{type:"string",group:"Data",defaultValue:null},"xAxisLabelFormatter":{type:"string",group:"Data",defaultValue:null},"xAxis2LabelFormatter":{type:"string",group:"Data",defaultValue:null},"plotAreaAxisTooltipFormatter":{type:"object",group:"Data",defaultValue:null},"tooltipFormatter":{type:"object",group:"Data",defaultValue:null},"dataLabelFormatter":{type:"object",group:"Data",defaultValue:null},"popoverFormatter":{type:"object",group:"Data",defaultValue:null},"chartSemanticColorFormatter":{type:"object",group:"Data",defaultValue:null},"internalVizChart":{type:"sap.ui.core.Control",group:"Data",defaultValue:null},"popoverSubHeader":{type:"sap.ui.core.Control",group:"Appearance",defaultValue:null},"popoverFooter":{type:"sap.ui.core.Control",group:"Appearance",defaultValue:null},"advancedChartSettings":{type:"object",group:"Appearance",defaultValue:null},"noData":{type:"sap.ui.core.Control",group:"Appearance",defaultValue:null}},aggregations:{"internalContent":{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},"chartPopover":{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},events:{"selectDataPoint":{},"popoverBeforeOpen":{},"popoverAfterOpen":{}}}});sap.ca.ui.charts.Chart.M_EVENTS={'selectDataPoint':'selectDataPoint','popoverBeforeOpen':'popoverBeforeOpen','popoverAfterOpen':'popoverAfterOpen'};jQuery.sap.require("sap.m.ScrollContainer");jQuery.sap.require("sap.m.ScrollContainer");jQuery.sap.require("sap.ca.ui.charts.ChartType");jQuery.sap.require("sap.ca.ui.charts.ChartSemanticColor");jQuery.sap.require("sap.ca.ui.charts.ChartColor");jQuery.sap.require("sap.ca.ui.charts.ClusterList");jQuery.sap.require("sap.ca.ui.charts.ChartFormatter");
sap.ca.ui.charts.Chart.prototype.init=function(){this._oScrollContainer=new sap.m.ScrollContainer(this._createId("scroll"),{width:"100%",height:"100%"});this.setAggregation("internalContent",this._oScrollContainer);this._oSelectedDataList=new sap.ca.ui.charts.ClusterList(this._createId("clusterList"));this._createPopover();this.oChartFormatter=sap.ca.ui.charts.ChartFormatter.getInstance();this._oMinimumShapeSizes={desktop:24,mobile:48,desktop_px:jQuery.proxy(function(){return this._oMinimumShapeSizes.desktop+"px"},this),mobile_px:jQuery.proxy(function(){return this._oMinimumShapeSizes.mobile+"px"},this)}};
sap.ca.ui.charts.Chart.prototype._createPopover=function(){var c=new sap.m.Bar(this._createId("popoverHeaderBar"),{contentMiddle:[new sap.m.Label(this._createId("--popoverLabel"),{text:sap.ca.ui.utils.resourcebundle.getText("ChartPopover.title")})],contentRight:(jQuery.device.is.phone)?[]:[new sap.m.Button(this._createId("--popoverCloseButton"),{icon:"sap-icon://decline",width:"22px",press:jQuery.proxy(this._closePopover,this)})]});this._oChartPopover=new sap.m.ResponsivePopover(this._createId("popover"),{modal:false,enableScrolling:true,verticalScrolling:true,horizontalScrolling:false,placement:sap.m.PlacementType.Auto,contentWidth:"100%",contentHeight:"100%",customHeader:c,content:[this._oSelectedDataList.getControl()]});this._oChartPopover.addStyleClass('sapCaUiChartPopOver');this.setAggregation("chartPopover",this._oChartPopover);if(!jQuery.device.is.phone){this._oChartPopover._oControl.oPopup.setAutoClose(false)}var s=sap.ui.getCore().getStaticAreaRef();s=sap.ui.getCore().getUIArea(s);s.addContent(this._oChartPopover,true);this._oChartPopover._bAppendedToUIArea=true;this._oChartPopover.attachAfterOpen(null,jQuery.proxy(this._afterOpenPopover,this))};
sap.ca.ui.charts.Chart.prototype._closePopover=function(){if(this._oChartPopover){if(this._oChartPopover.isOpen()){this._oChartPopover.close()}}};
sap.ca.ui.charts.Chart.prototype._afterOpenPopover=function(){this.firePopoverAfterOpen()};
sap.ca.ui.charts.Chart.prototype.exit=function(){this._deregisterEvent();this._closePopover();if(this._oSelectedDataList){this._oSelectedDataList.destroy();this._oSelectedDataList=null}};
sap.ca.ui.charts.Chart.prototype._deregisterEvent=function(){if(jQuery.device.is.desktop){jQuery(window).unbind("resize",jQuery.proxy(this._onResize,this))}else{sap.ui.Device.orientation.detachHandler(this._onOrientationChange,this);sap.ui.Device.resize.detachHandler(this._onResize,this)}};
sap.ca.ui.charts.Chart.prototype._createId=function(i){return this.getId()+"-"+i};
sap.ca.ui.charts.Chart.prototype._findInCss=function(r){var m=[];if(!this._sapCaStylesheet){var s=null;jQuery.each(document.styleSheets,function(i,S){if((!!S.ownerNode&&/sap.ca.ui/.test(S.ownerNode.id))||(!!S.owningElement&&/sap.ca.ui/.test(S.owningElement.id))){s=S}});if(s==null){jQuery.each(document.styleSheets,function(i,S){if(S.rules&&S.rules.length>0){jQuery.each(S.rules,function(I,R){if(r.test(R.selectorText)){s=S;return false}})}else if(S.cssRules&&S.cssRules.length>0){jQuery.each(S.cssRules,function(I,R){if(r.test(R.selectorText)){s=S;return false}})}if(s){return false}})}this._sapCaStylesheet=s}if(this._sapCaStylesheet){if(this._sapCaStylesheet.rules&&this._sapCaStylesheet.rules.length>0){jQuery.each(this._sapCaStylesheet.rules,function(i,R){if(r.test(R.selectorText)){m.push(R)}})}else if(this._sapCaStylesheet.cssRules&&this._sapCaStylesheet.cssRules.length>0){jQuery.each(this._sapCaStylesheet.cssRules,function(i,R){if(r.test(R.selectorText)){m.push(R)}})}}return m};
sap.ca.ui.charts.Chart.prototype._getColorPalette=function(){if((!this._aColorPalette)||this._aColorPalette.length===0){var c=[];var p=this._findInCss(/.sapCaUiChartColorPalette-/);jQuery.each(p,function(i,r){c.push(r.style.color)});this._aColorPalette=c}return this._aColorPalette};
sap.ca.ui.charts.Chart.prototype._getSemanticPalette=function(){if(!this._aSemanticPalette||!this._aSemanticPalette.length){var s=[];var t=this;function a(c,b){var p=t._findInCss(b);if(p.length>0){var r=p[0];s[c]=r.style.color}};a(sap.ca.ui.charts.ChartSemanticColor.NeutralDark,/.sapCaUiChartSemanticColor-Neutral-Dark/);a(sap.ca.ui.charts.ChartSemanticColor.Neutral,/.sapCaUiChartSemanticColor-Neutral/);a(sap.ca.ui.charts.ChartSemanticColor.NeutralLight,/.sapCaUiChartSemanticColor-Neutral-Light/);a(sap.ca.ui.charts.ChartSemanticColor.GoodDark,/.sapCaUiChartSemanticColor-Good-Dark/);a(sap.ca.ui.charts.ChartSemanticColor.Good,/.sapCaUiChartSemanticColor-Good/);a(sap.ca.ui.charts.ChartSemanticColor.GoodLight,/.sapCaUiChartSemanticColor-Good-Light/);a(sap.ca.ui.charts.ChartSemanticColor.CriticalDark,/.sapCaUiChartSemanticColor-Critical-Dark/);a(sap.ca.ui.charts.ChartSemanticColor.Critical,/.sapCaUiChartSemanticColor-Critical/);a(sap.ca.ui.charts.ChartSemanticColor.CriticalLight,/.sapCaUiChartSemanticColor-Critical-Light/);a(sap.ca.ui.charts.ChartSemanticColor.BadDark,/.sapCaUiChartSemanticColor-Bad-Dark/);a(sap.ca.ui.charts.ChartSemanticColor.Bad,/.sapCaUiChartSemanticColor-Bad/);a(sap.ca.ui.charts.ChartSemanticColor.BadLight,/.sapCaUiChartSemanticColor-Bad-Light/);this._aSemanticPalette=s}return this._aSemanticPalette};
sap.ca.ui.charts.Chart.prototype._getSecondaryColorPalette=function(c){var d=this.getDataset();var s=[];if(d&&d.getVIZDataset()){var a=d.getVIZDataset().getMeasureValuesGroupByIdx(0).getMeasureValues().length;$.extend(s,c);s.splice(0,a)}return s};
sap.ca.ui.charts.Chart.prototype._getDataLabelCss=function(){if(!this._sDataLabelRule){var d="";var a=this._findInCss(/.sapCaUiChart .v-datalabel/);if(a.length>0){var r=a[0];d=".v-datalabel {";for(var i=0;i<r.style.length;i++){d+=r.style[i]+": "+r.style[r.style[i]]+"; "}d+="}"}this._sDataLabelRule=d}return this._sDataLabelRule};
sap.ca.ui.charts.Chart.prototype._getDataPointCss=function(){if(!this._sDataPointRule){var d="";var a=this._findInCss(/.sapCaUiChart .v-datapoint/);if(a.length>0){var r=a[0];d=".v-datapoint {";for(var i=0;i<r.style.length;i++){d+=r.style[i]+": "+r.style[r.style[i]]+"; "}d+="}"}this._sDataPointRule=d}return this._sDataPointRule};
sap.ca.ui.charts.Chart.prototype._getEMSize=function(i){if(!this._emSize){this._emSize=parseFloat($("body").css("font-size"))}var p;if(jQuery.sap.endsWith(i,"em")||jQuery.sap.endsWith(i,"rem")){p=this._emSize*parseFloat(i)}else{p=parseFloat(i)}return p};
sap.ca.ui.charts.Chart.prototype._getMarkerSize=function(){if(!this._iMarkerSize){var m=0;var a=this._findInCss(/.sapCaUiChartMarkerSize/);if(a.length>0){var r=a[0];var f=r.style['font-size'];if(f==null){f=r.style['fontSize']}m=parseInt(this._getEMSize(f))}this._iMarkerSize=m}return this._iMarkerSize};
sap.ca.ui.charts.Chart.prototype._getAlignedScale=function(){var s=0;var a;var b=null;if(this.getDataset()){var c=this.getDataset().getVIZDataset();var m=[];for(var j=0;j<c.getMeasureValuesGroupByIdx(1).getMeasureValues()[0]._values[0].length;j++){m.push(c.getMeasureValuesGroupByIdx(1).getMeasureValues()[0]._values[0][j]+c.getMeasureValuesGroupByIdx(1).getMeasureValues()[1]._values[0][j])}var d=Math.max.apply(Math,m);var e=Math.min.apply(Math,m);for(var i=0;i<c.getMeasureValuesGroupCount();i++){var t=Math.max(Math.max.apply(Math,c.getMeasureValuesGroupByIdx(i).getMeasureValues()[0]._values[0]),d);var f=Math.min(Math.min.apply(Math,c.getMeasureValuesGroupByIdx(i).getMeasureValues()[0]._values[0]),e);if(!a){a=t}s=(s<f)?s:f;a=(a>t)?a:t}a=(a>0)?parseInt(1.05*a):parseInt(0.95*a);b={fixedRange:true,minValue:s,maxValue:a}}return b};
sap.ca.ui.charts.Chart.prototype._getMergedChartSettings=function(){var c=this._getChartSettings();return jQuery.extend(true,c,this.getAdvancedChartSettings())};
sap.ca.ui.charts.Chart.prototype._getChartSettings=function(){var c=this._getColorPalette().concat();if(this.getDataset()){var s=this._getSemanticPalette();if(this._vizChartType.name!=sap.ca.ui.charts.ChartType.Bubble){var m=this.getDataset().getMeasures();for(var i=0;i<m.length;i++){var f=m[i].data("fillColor");if(f!=null&&s.hasOwnProperty(f)){c.splice(i,0,s[f])}}}else{var d=this.getDataset().getDimensions();var a=this.getDataset().getVIZDataset()._dataSet.analysisAxis[0].data;var b={};for(var i=0;i<d.length;i++){var e=d[i].data("fillColors");if(e!=null){for(var j=0;j<a.length;j++){if(a[j].name==d[i].getName()){var v=a[j].values;var u=[];jQuery.each(v,function(i,n){if(jQuery.inArray(n,u)===-1)u.push(n)});for(var k=0;k<u.length;k++){if(e.hasOwnProperty(u[k])){b[k]=sap.ui.core.theming.Parameters.get(e[u[k]]);var g=jQuery.inArray(b[k],c);if(g!=-1){c.splice(g,1)}}}}}}}for(var p in b){c.splice(p,0,b[p])}}}var h={width:"100%",height:"100%",general:{layout:{padding:0}},plotArea:{colorPalette:c,marker:{visible:true,size:this._getMarkerSize()},axisTooltip:{formatString:this.getProperty("plotAreaAxisTooltipFormatter")},animation:{dataLoading:true,dataUpdating:true,resizing:false}},title:{visible:false},dataLabel:{visible:this.getProperty("showDataLabel"),position:this._vizChartType.dataLabelPosition,formatString:this.getProperty("dataLabelFormatter")},legend:{visible:this.getShowLegend(),isScrollable:true},tooltip:{visible:this.getShowTooltip(),formatString:this.getProperty("tooltipFormatter")},hoverline:{visible:this._vizChartType.showHoverLine},interaction:{supportLassoEvent:false,selectability:{mode:this.getSelectionMode().toLowerCase()}},background:{visible:true,border:{left:{visible:false},right:{visible:false},bottom:{visible:true},top:{visible:true}}},xAxis:{label:{formatString:this.getProperty("xAxisLabelFormatter")}},xAxis2:{label:{formatString:this.getProperty("xAxis2LabelFormatter")},visible:this.getProperty("secondAxisVisible")},yAxis:{label:{formatString:this.getProperty("yAxisLabelFormatter")}},yAxis2:{label:{formatString:this.getProperty("yAxis2LabelFormatter")},visible:this.getProperty("secondAxisVisible")}};if(this._vizChartType.dualAxis){h.plotArea.primaryValuesColorPalette=c;h.plotArea.secondaryValuesColorPalette=this._getSecondaryColorPalette(c);if(!this.getProperty("secondAxisVisible")&&this._vizChartType.alignScales){var l=this._getAlignedScale();h.yAxis2.scale=l;h.yAxis.scale=l}}return h};
sap.ca.ui.charts.Chart.prototype.applySettings=function(s,S){sap.ui.core.Control.prototype.applySettings.apply(this,arguments);this._initChart()};
sap.ca.ui.charts.Chart.prototype._initChart=function(){this._vizChartType=sap.ca.ui.charts.ChartType.getChartProperties(this.getChartType());var c=this._getMergedChartSettings();if(this._vizChartType!=null){this.setLabel(this._vizChartType.displayLabel);if(this.getIcon()==""){this.setProperty("icon",this._vizChartType.icon)}if(this._oInternalVizChart!=null){this._oInternalVizChart.destroy()}c.tooltip=null;this._oInternalVizChart=new sap.viz.ui5[this._vizChartType.name](this._createId("vizChart"),c);this._oInternalVizChart.addDelegate({onAfterRendering:function(){this._onResizeInt()}},true,this);this._oInternalVizChart.attachBeforeCreateViz(function(e){var u=e.getParameter("usrOptions");if(this._vizChartType.vizType){u.type=this._vizChartType.vizType}u.css=this._getDataLabelCss()+this._getDataPointCss();u.options=this._getMergedChartSettings()},this);this._oScrollContainer.addContent(this._oInternalVizChart);this._oScrollContainer.setVertical(this._vizChartType.scroll.vertical);this._oScrollContainer.setHorizontal(this._vizChartType.scroll.horizontal);this._oInternalVizChart.attachInitialized(this.onChartInitialized,this);this._oInternalVizChart.attachSelectData(this.onSelectData,this);this._oInternalVizChart.attachDeselectData(this.onDeselectData,this);if(jQuery.sap.touchEventMode=="ON"&&jQuery.device.is.tablet){this._oInternalVizChart.attachBrowserEvent("touchmove",jQuery.proxy(this._closePopover,this))}this.setMinShapeSize()}else{jQuery.sap.log.error("Cannot instantiate the Chart control, "+this.getVizType()+" is not a recognized type")}};
sap.ca.ui.charts.Chart.prototype.updateBindings=function(u,m){sap.ui.core.Control.prototype.updateBindings.apply(this,arguments)};
sap.ca.ui.charts.Chart.prototype.invalidate=function(o,i){if(i){if(this._sInvalidateDelay){jQuery.sap.clearDelayedCall(this._sInvalidateDelay)}this._sInvalidateDelay=jQuery.sap.delayedCall(200,this,sap.ui.core.Control.prototype.invalidate,arguments)}else{sap.ui.core.Control.prototype.invalidate.apply(this,arguments)}};
sap.ca.ui.charts.Chart.prototype.setChartType=function(t){this.setProperty("chartType",t);this.setProperty("icon","");this._vizChartType=sap.ca.ui.charts.ChartType.getChartProperties(this.getChartType());this._initChart();return this};
sap.ca.ui.charts.Chart.prototype.setTitle=function(t){this.setProperty("title",t);return this};
sap.ca.ui.charts.Chart.prototype.setInternalVizChart=function(i){jQuery.sap.log.warning("InternalVizChart cannot be set from outside a sap.ca.ui.chart.Chart class.");return this};
sap.ca.ui.charts.Chart.prototype.setDataset=function(d){this._oInternalVizChart.setDataset(d);this.setProperty("dataset",d);return this};
sap.ca.ui.charts.Chart.prototype.getDataset=function(){var d=null;if(this._oInternalVizChart){d=this._oInternalVizChart.getDataset()}return d};
sap.ca.ui.charts.Chart.prototype.getInternalVizChart=function(){return this._oInternalVizChart};
sap.ca.ui.charts.Chart.prototype.setModel=function(m){if(this._oSelectedDataList){this._oSelectedDataList.reset()}sap.ui.core.Control.prototype.setModel.apply(this,arguments);return this};
sap.ca.ui.charts.Chart.prototype.setHeight=function(h){this.setProperty("height",h);return this};
sap.ca.ui.charts.Chart.prototype.setWidth=function(w){this.setProperty("width",w);return this};
sap.ca.ui.charts.Chart.prototype.setShowLegend=function(s){this.setProperty("showLegend",s);if(this._oInternalVizChart){this._oInternalVizChart.getLegend().setVisible(s)}return this};
sap.ca.ui.charts.Chart.prototype.setShowTooltip=function(s){this.setProperty("showTooltip",s);if(this._oInternalVizChart){var t=this._oInternalVizChart.getTooltip();if(t.setVisible){t.setVisible(s)}if(t.setEnabled){t.setEnabled(s)}}return this};
sap.ca.ui.charts.Chart.prototype.setSelectionMode=function(s){this.setProperty("selectionMode",s);if(this._oInternalVizChart){this._oInternalVizChart.getInteraction().getSelectability().setSelectionMode(s.toLowerCase())}return this};
sap.ca.ui.charts.Chart.prototype.setXAxisLabelFormatter=function(f){var a=this.oChartFormatter.addFormatter(this._oInternalVizChart,"xAxisLabelFormatter",f);this.setProperty("xAxisLabelFormatter",a);return this};
sap.ca.ui.charts.Chart.prototype.setXAxis2LabelFormatter=function(f){var a=this.oChartFormatter.addFormatter(this._oInternalVizChart,"xAxis2LabelFormatter",f);this.setProperty("xAxis2LabelFormatter",a);return this};
sap.ca.ui.charts.Chart.prototype.setYAxisLabelFormatter=function(f){var a=this.oChartFormatter.addFormatter(this._oInternalVizChart,"yAxisLabelFormatter",f);this.setProperty("yAxisLabelFormatter",a);return this};
sap.ca.ui.charts.Chart.prototype.setYAxis2LabelFormatter=function(f){var a=this.oChartFormatter.addFormatter(this._oInternalVizChart,"yAxis2LabelFormatter",f);this.setProperty("yAxis2LabelFormatter",a);return this};
sap.ca.ui.charts.Chart.prototype.setDataLabelFormatter=function(f){var a;var b=[[]];if(Array.isArray(f)){for(var i=0;i<f.length;i++){if(Array.isArray(f[i])){if(i>0){b.push([])}for(var j=0;j<f[i].length;j++){a=this.oChartFormatter.addFormatter(this._oInternalVizChart,"dataLabelFormatter"+i+"-"+j,f[i][j]);b[i][j]=a}}else{jQuery.sap.log.error("dataLabelFormatter must be an array of arrays");return this}}}else{jQuery.sap.log.error("dataLabelFormatter must be an array of arrays");return this}this.setProperty("dataLabelFormatter",b);return this};
sap.ca.ui.charts.Chart.prototype.setPlotAreaAxisTooltipFormatter=function(f){var a;var b=[];if(Array.isArray(f)){for(var i=0;i<f.length;i++){a=this.oChartFormatter.addFormatter(this._oInternalVizChart,"plotAreaAxisTooltipFormatter"+i,f[i]);b[i]=a}}else{jQuery.sap.log.error("plotAreaAxisTooltipFormatter must be an array");return this}this.setProperty("plotAreaAxisTooltipFormatter",b);return this};
sap.ca.ui.charts.Chart.prototype.setTooltipFormatter=function(f){var a;var b=[[]];if(Array.isArray(f)){for(var i=0;i<f.length;i++){if(Array.isArray(f[i])){if(i>0){b.push([])}for(var j=0;j<f[i].length;j++){a=this.oChartFormatter.addFormatter(this._oInternalVizChart,"tooltipFormatter"+i+"-"+j,f[i][j]);b[i][j]=a}}else{jQuery.sap.log.error("tooltipFormatter must be an array of arrays");return this}}}else{jQuery.sap.log.error("tooltipFormatter must be an array of arrays");return this}this.setProperty("tooltipFormatter",b);return this};
sap.ca.ui.charts.Chart.prototype.setPopoverFormatter=function(f){var a;var b=[[]];if(Array.isArray(f)){for(var i=0;i<f.length;i++){if(Array.isArray(f[i])){if(i>0){b.push([])}for(var j=0;j<f[i].length;j++){a=this.oChartFormatter.addFormatter(this._oInternalVizChart,"popoverFormatter"+i+"-"+j,f[i][j]);b[i][j]=a}}else{jQuery.sap.log.error("popoverFormatter must be an array of arrays");return this}}}else{jQuery.sap.log.error("popoverFormatter must be an array of arrays");return this}this.setProperty("popoverFormatter",b);return this};
sap.ca.ui.charts.Chart.prototype.setAdvancedChartSettings=function(s){this.setProperty("advancedChartSettings",s);return this};
sap.ca.ui.charts.Chart.prototype.setMinShapeSize=function(m){if(jQuery.device.is.desktop){if(typeof m!=="undefined")jQuery.sap.log.warning("MinShapeSize must be 24px for desktop. Forcing to 24px.");m=this._oMinimumShapeSizes.desktop_px()}else{if(typeof m!=="undefined")jQuery.sap.log.warning("MinShapeSize must be 48px to be clickable on mobile. Forcing to 48px.");m=this._oMinimumShapeSizes.mobile_px()}this.setProperty("minShapeSize",m);return this};
sap.ca.ui.charts.Chart.prototype.onChartInitialized=function(e){var s=this.getChartSemanticColorFormatter();if(s!=null){var c=d3.select(this._oInternalVizChart.getDomRef()).select('.v-m-root');var a=this._getSemanticPalette();c.selectAll('g.v-datashape').selectAll('rect').attr('fill',function(d){var b=s(d);var f=d.fillColor;if(a.hasOwnProperty(b)){f=a[b]}return f});c.selectAll('g.v-datashape').selectAll('path').attr('fill',function(d){var b=s(d);var f=d.fillColor;if(a.hasOwnProperty(b)){f=a[b]}return f})}};
sap.ca.ui.charts.Chart.prototype.onSelectData=function(e){var s=this._oInternalVizChart.selection();var a=null;if(s.length>0){a=s[s.length-1]}if(this.getShowPopover()){var d=e.getParameter("data");var t=d[d.length-1].target;for(var p=0;p<d.length;p++){for(var q=0;q<d[p].data.length;q++){if(!d[p].data[q]||!d[p].data[q].ctx||!d[p].data[q].val){continue}var c=d[p].data[q].ctx;var C=d[p].target.attributes.fill.value;var v=d[p].data[q].val;var b=this._oInternalVizChart.getDataset().getVIZDataset();var f=b._analysisAxis[0]._dimensionLabels;var m=b._measureValuesGroup;var g=m[c.path.mg].getMeasureValues();var M=g[c.path.mi]._uId;var A="";var G=[];if(c.type==='Measure'){var h=c.path;var k=h.dii_a1.toString();k+=h.dii_a2.toString();k+=h.mg.toString();k+=h.mi.toString();var j=this;jQuery.each(f,function(i,o){A=o._values[c.path.dii_a1];G.push(A);if(j._oSelectedDataList.getGroupIndexFor(G)===-1){j._oSelectedDataList.addGroup({key:G,title:A})}});var l="";if(!this.getProperty("popoverFormatter")||!Array.isArray(this.getProperty("popoverFormatter"))||this.getProperty("popoverFormatter").length<c.path.mg||!this.getProperty("popoverFormatter")[c.path.mg]||!Array.isArray(this.getProperty("popoverFormatter")[c.path.mg])||this.getProperty("popoverFormatter")[c.path.mg].length==0){l=sap.ca.ui.charts.DefaultFormatterFunction.STANDARDNUMBER}else{if(this.getProperty("popoverFormatter")[c.path.mg].length<c.path.mi){l=this.getProperty("popoverFormatter")[c.path.mg][0]}else{l=this.getProperty("popoverFormatter")[c.path.mg][c.path.mi]}}if(this._oSelectedDataList.getItemIndexFor(G,k)===-1){this._oSelectedDataList.addItemTo(G,[{key:k,color:C,label:M,value:this.oChartFormatter.format(v.toString(),l)}])}}}}this.firePopoverBeforeOpen({isOpen:this._oChartPopover.isOpen(),openBy:t,selection:s});if(!this._oChartPopover.isOpen()){if(t.width!=null){this._oChartPopover.setOffsetX(Math.floor(t.width.baseVal.value));this._oChartPopover.setOffsetY(Math.floor((t.height.baseVal.value/2)))}if(this._vizChartType.name==sap.ca.ui.charts.ChartType.Bubble){if(t&&t.getBoundingClientRect()){var B=t.getBoundingClientRect().width;var n=t.getBoundingClientRect().height;if(B){this._oChartPopover.setOffsetX(Math.floor(B/2));this._oChartPopover.setOffsetY(Math.floor(n/2))}}}if(!jQuery.device.is.phone){this._oChartPopover._oControl.$().css("max-height:"+this._oInternalVizChart.getHeight())}this._oChartPopover.openBy(t)}}this.fireSelectDataPoint({popover:this._oChartPopover,srcEvent:e,selection:s,selectedItem:a})};
sap.ca.ui.charts.Chart.prototype.onDeselectData=function(e){var s=this._oInternalVizChart.selection();if(this.getShowPopover()){if(s.length==0){this._oSelectedDataList.reset();this._closePopover()}else{var d=e.getParameter("data");for(var p=0;p<d.length;p++){for(var q=0;q<d[p].data.length;q++){if(!d[p].data[q]||!d[p].data[q].ctx||!d[p].data[q].val){continue}var c=d[p].data[q].ctx;if(c.type=='Measure'){var a=c.path;var k=a.dii_a1.toString();k+=a.dii_a2.toString();k+=a.mg.toString();k+=a.mi.toString();var v=this._oInternalVizChart.getDataset().getVIZDataset();var b=v._analysisAxis[0]._dimensionLabels;var A="";var g=[];jQuery.each(b,function(i,f){g.push(f._values[c.path.dii_a1])});if(this._oSelectedDataList.getItemIndexFor(g,k)!==-1){this._oSelectedDataList.removeItemFrom(g,k)}if(this._oSelectedDataList.getNumberOfItemsFor(g)===0){this._oSelectedDataList.removeGroup(g)}}}}}}this.fireSelectDataPoint({popover:this._oChartPopover,srcEvent:e,selection:this._oInternalVizChart.selection(),selectedItem:null})};
sap.ca.ui.charts.Chart.prototype.onBeforeRendering=function(){this._deregisterEvent()};
sap.ca.ui.charts.Chart.prototype.onAfterRendering=function(){if(jQuery.device.is.desktop){jQuery(window).bind("resize",jQuery.proxy(this._onResize,this))}else{sap.ui.Device.orientation.attachHandler(this._onOrientationChange,this);sap.ui.Device.resize.attachHandler(this._onResize,this)}};
sap.ca.ui.charts.Chart.prototype._onResize=function(){if(this._sDelayedResize){jQuery.sap.clearIntervalCall(this._sDelayedResize)}this._sDelayedResize=jQuery.sap.delayedCall(200,this,this._onResizeInt)};
sap.ca.ui.charts.Chart.prototype._onResizeInt=function(){this._closePopover();var d=this._oInternalVizChart.getDataset();if(!d){return}var v=d.getVIZDataset();var s=parseInt(this.getMinShapeSize());if(v&&!v._emptyDataset&&v._analysisAxis.length>0){var S=v._analysisAxis[0]._dimensionLabels[0]._values.length;var p=S;var i=0;if(v._analysisAxis[1]!=null){S*=v._analysisAxis[1]._dimensionLabels[0]._values.length;i=S}if(!this._vizChartType.stacked){S*=v._measures.length;i=S*(v._measures.length-1)}var c=(S*s)+(p*s)+(i*4);var a=this.getWidth();var b=this.getHeight();var e=parseInt(a);var f=parseInt(b);if(jQuery.sap.endsWith(a,"%")||a=="auto"){if(this.getParent()!=null&&this.getParent().getDomRef()!=null){var D=this.$();var P=D.parents('.sapMPage').first();var $=P.children('section').first();var h=$.parents('.sapMNavItemHidden');if(h.length!=0){h.removeClass('sapMNavItemHidden')}if($.length==0){$=this.getParent().$().parents('section').first()}if($.length==0){$=D.parents('body').first()}var g=$.width();var j=0;if($&&$.offset()){j=$.offset().left}var E=0;if(D&&D.offset()){E=D.offset().left}var k=1;var l=D;while(l!=null&&l.length!=0&&l.attr("id")!=$.attr("id")){var m=parseInt(l.css("margin-right"));var n=parseInt(l.css("padding-right"));var o=parseInt(l.css("border-right-width"));if(!isNaN(m)){k+=m}if(!isNaN(n)){k+=n}if(!isNaN(o)){k+=o}l=l.parent()}if(h.length!=0){h.addClass('sapMNavItemHidden')}e=(g-(E-j)-k)}else if(this.getUIArea()){e=jQuery(this.getUIArea().oRootNode).width()}else{e="800"}e=(e*parseInt(a))/100}if(jQuery.sap.endsWith(b,"%")||b=="auto"){if(this.getParent()!=null&&this.getParent().getDomRef()!=null){var D=this.$();var P=D.parents('.sapMPage').first();var $=P.children('section').first();var h=$.parents('.sapMNavItemHidden');if(h.length!=0){h.removeClass('sapMNavItemHidden')}if($.length==0){$=this.getParent().$().parents('section').first()}if($.length==0){$=D.parents('body').first()}var q=$.height();var r=0;if($&&$.offset()){r=$.offset().top}var t=0;if(D&&D.offset()){t=D.offset().top}var u=0;var l=D;while(l!=null&&l.length!=0&&l.attr("id")!=$.attr("id")){var w=parseInt(l.css("margin-bottom"));var x=parseInt(l.css("padding-bottom"));var y=parseInt(l.css("border-bottom-width"));if(!isNaN(m)){u+=w}if(!isNaN(x)){u+=x}if(!isNaN(y)){u+=y}l=l.parent()}if(h.length!=0){h.addClass('sapMNavItemHidden')}f=(q-(t-r)-u)}else if(this.getUIArea()){f=jQuery(this.getUIArea().oRootNode).height()}else{f="480"}if(this.getParent()&&this.getParent()instanceof sap.ca.ui.charts.ChartToolBar&&parseInt(b)!=100){var z=this.getParent().$().find(".sapMBar").height();f=(((f+z)*parseInt(b))/100)-z}else{f=(f*parseInt(b))/100}}var A={height:0,width:0};if(f==0){f=100;jQuery.sap.delayedCall(200,this,this.invalidate)}if(this._vizChartType.scroll.horizontal){if(c>e){this._oInternalVizChart.setWidth(c+"px");A=jQuery.sap.scrollbarSize()}else{this._oInternalVizChart.setWidth(e+"px")}this._oInternalVizChart.setHeight((f-A.height)+"px")}else if(this._vizChartType.scroll.vertical){if(c>f){this._oInternalVizChart.setHeight(c+"px");this._oScrollContainer.setHeight(f+"px");if(this._oScrollContainer.$()){this._oScrollContainer.$().height(f+"px")}A=jQuery.sap.scrollbarSize()}else{this._oInternalVizChart.setHeight(f+"px");this._oScrollContainer.setHeight("100%");if(this._oScrollContainer.$()){this._oScrollContainer.$().height("100%")}}this._oInternalVizChart.setWidth((e-A.width)+"px")}else{this._oInternalVizChart.setWidth(e+"px");this._oInternalVizChart.setHeight(f+"px")}if(this._oInternalVizChart.$()){this._oInternalVizChart.$().height(this._oInternalVizChart.getHeight());this._oInternalVizChart.$().width(this._oInternalVizChart.getWidth())}}else if(!v||v._emptyDataset){this._oScrollContainer.setHeight("100%");this._oScrollContainer.setWidth("100%");if(this._oScrollContainer.$()){this._oScrollContainer.$().height("100%");this._oScrollContainer.$().width("100%")}}};
sap.ca.ui.charts.Chart.prototype._onOrientationChange=function(){this._onResize()};
sap.ca.ui.charts.Chart.prototype.setPopoverSubHeader=function(s){if(s&&s instanceof sap.m.Bar){this._oChartPopover.setSubHeader(s)}};
sap.ca.ui.charts.Chart.prototype.setPopoverFooter=function(f){if(f){if(f instanceof sap.m.Bar){if(!jQuery.device.is.phone){this._oChartPopover._oControl.setFooter(f)}else{var p=new sap.m.Page({showHeader:false,showFooter:true,footer:f,content:[this._oSelectedDataList.getControl()]});this._oChartPopover.destroyContent();this._oChartPopover.addContent(p)}}else if(f instanceof sap.ui.core.Control){if(!jQuery.device.is.phone){this._oChartPopover.addContent(f)}else{f.addStyleClass('sapCaUiPopOverFooter');var p=new sap.m.Page({showHeader:false,showFooter:false,content:[this._oSelectedDataList.getControl(),f]});this._oChartPopover.destroyContent();this._oChartPopover.addContent(p)}}}};
sap.ca.ui.charts.Chart.prototype.setNoData=function(c){this._oInternalVizChart.setNoData(c);return this};
sap.ca.ui.charts.Chart.prototype.getNoData=function(){return this._oInternalVizChart.getNoData()};
