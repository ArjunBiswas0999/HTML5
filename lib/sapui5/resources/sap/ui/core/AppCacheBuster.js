/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2013 SAP AG. All rights reserved
 */
jQuery.sap.require("sap.ui.core.Core");jQuery.sap.require("sap.ui.thirdparty.URI");jQuery.sap.declare("sap.ui.core.AppCacheBuster",false);(function(){var c=sap.ui.getCore().getConfiguration();var l=c.getLanguage();var i={};var a=jQuery.ajax;var I=jQuery.sap.includeScript;var f=jQuery.sap.includeStyleSheet;var v=sap.ui.base.ManagedObject.prototype.validateProperty;var L=document.location.href.replace(/\?.*|#.*/g,"");var b=URI("./").absoluteTo(L);var A=b.toString();var u=URI(jQuery.sap.getModulePath("","/../"));var o=u.toString();if(u.is("relative")){u=u.absoluteTo(L)}var B=u.normalize().toString();var r=URI("resources").absoluteTo(B).toString();var F=new RegExp("^"+jQuery.sap.escapeRegExp(r));sap.ui.core.AppCacheBuster={init:function(){var C=sap.ui.core.AppCacheBuster.convertURL;var n=sap.ui.core.AppCacheBuster.normalizeURL;var d=function(U){if(U&&typeof(U)==="string"){U=n(U);return!U.match(F)}return false};jQuery.ajax=function(e,g){if(e&&e.url&&d(e.url)){e.url=C(e.url)}return a.apply(this,arguments)};jQuery.sap.includeScript=function(U,s){var e=Array.prototype.slice.apply(arguments);if(d(e[0])){e[0]=C(e[0])}return I.apply(this,e)};jQuery.sap.includeStyleSheet=function(U,s){var e=Array.prototype.slice.apply(arguments);if(d(e[0])){e[0]=C(e[0])}return f.apply(this,e)};sap.ui.base.ManagedObject.prototype.validateProperty=function(p,V){var e=Array.prototype.slice.apply(arguments);if(d(e[1])){var m=this.getMetadata(),P=m.getAllProperties()[p];if(P){if(P.type==="sap.ui.core.URI"){e[1]=C(e[1])}}}return v.apply(this,e)}},exit:function(){jQuery.ajax=a;jQuery.sap.includeScript=I;jQuery.sap.includeStyleSheet=f;sap.ui.base.ManagedObject.prototype.validateProperty=v;i={}},register:function(B){jQuery.sap.log.debug("sap.ui.core.AppCacheBuster.register(\""+B+"\");");var s=sap.ui.core.AppCacheBuster.normalizeURL(B);jQuery.sap.log.debug("  --> normalized to: \""+s+"\"");if(!i[s]){var U=s+"sap-ui-cachebuster-info.json?sap-ui-language="+l;jQuery.sap.log.info("Loading AppCacheBuster index file from: \""+U+"\".");var R=jQuery.sap.sjax({url:U,dataType:"json"});if(R&&R.data){i[s]=R.data}else{jQuery.sap.log.error("Failed to load AppCacheBuster index file from: \""+U+"\".")}}},convertURL:function(U){jQuery.sap.log.debug("sap.ui.core.AppCacheBuster.convertURL(\""+U+"\");");if(i&&U){U=sap.ui.core.AppCacheBuster.normalizeURL(U);jQuery.sap.log.debug("  --> normalized to: \""+U+"\"");if(U&&sap.ui.core.AppCacheBuster.handleURL(U)){jQuery.each(i,function(B,m){var s;if(B&&U.length>=B.length&&U.slice(0,B.length)===B){s=U.slice(B.length);if(m[s]){U=B+"~"+m[s]+"~/"+s;jQuery.sap.log.debug("  ==> return \""+U+"\";");return false}}})}}return U},normalizeURL:function(U){var u=URI(U||"./");if(u.is("relative")){u=u.absoluteTo(L)}return u.normalize().toString()},handleURL:function(U){return true}};if(c.getAppCacheBuster()){sap.ui.core.AppCacheBuster.init();var u=URI(o);if(u.is("relative")){sap.ui.core.AppCacheBuster.register(u.toString())}}}());
