/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2013 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.ui.commons.form.ResponsiveLayout");jQuery.sap.require("sap.ui.commons.library");jQuery.sap.require("sap.ui.commons.form.FormLayout");sap.ui.commons.form.FormLayout.extend("sap.ui.commons.form.ResponsiveLayout",{metadata:{library:"sap.ui.commons"}});jQuery.sap.require("sap.ui.commons.Panel");jQuery.sap.require("sap.ui.commons.layout.ResponsiveFlowLayout");jQuery.sap.require("sap.ui.commons.layout.ResponsiveFlowLayoutData");(function(){sap.ui.commons.form.ResponsiveLayout.prototype.init=function(){this.mContainers={}};sap.ui.commons.form.ResponsiveLayout.prototype.exit=function(){var t=this;for(var C in this.mContainers){h(t,C)}this._mainRFLayout.destroy();delete this._mainRFLayout};sap.ui.commons.form.ResponsiveLayout.prototype.onBeforeRendering=function(E){var F=this.getParent();if(!F||!(F instanceof sap.ui.commons.form.Form)){return}var t=this;_(t,F);k(t,F)};sap.ui.commons.form.ResponsiveLayout.prototype.contentOnAfterRendering=function(F,C){sap.ui.commons.form.FormLayout.prototype.contentOnAfterRendering.apply(this,arguments);if(C.getWidth&&!C.getWidth()){C.$().css("width","100%")}};sap.ui.commons.form.ResponsiveLayout.prototype.toggleContainerExpanded=function(C){var E=C.getExpanded();var s=C.getId();if(this.mContainers[s]&&this.mContainers[s][0]){var p=this.mContainers[s][0];if(p.getCollapsed()==E){p.setCollapsed(!E)}}};sap.ui.commons.form.ResponsiveLayout.prototype.onLayoutDataChange=function(E){var s=E.srcControl;if(s instanceof sap.ui.commons.form.FormContainer){if(this._mainRFLayout){this._mainRFLayout.onLayoutDataChange(E)}}else if(s instanceof sap.ui.commons.form.FormElement){var C=s.getParent().getId();if(this.mContainers[C]&&this.mContainers[C][1]){this.mContainers[C][1].onLayoutDataChange(E)}}else{var p=s.getParent();if(p instanceof sap.ui.commons.form.FormElement){var o=p.getParent();var C=o.getId();var i=p.getId();if(this.mContainers[C]&&this.mContainers[C][2]&&this.mContainers[C][2][i]){this.mContainers[C][2][i][0].onLayoutDataChange(E)}}}};var _=function(L,F){var C=F.getFormContainers();var m=C.length;for(var i=0;i<m;i++){var o=C[i];var s=o.getId();var p=undefined;var r=undefined;if(L.mContainers[s]&&L.mContainers[s][1]){r=L.mContainers[s][1]}else{r=d(L,o,undefined)}var t=o.getTitle();if(t||o.getExpandable()){if(L.mContainers[s]&&L.mContainers[s][0]){p=L.mContainers[s][0];p.setCollapsed(!o.getExpanded())}else{p=a(L,o,r);e(r,true)}}else{if(L.mContainers[s]&&L.mContainers[s][0]){b(L.mContainers[s][0]);e(r,false)}}var n=c(L,o,r);L.mContainers[s]=[p,r,n]}var O=l(L.mContainers);if(m<O){for(var s in L.mContainers){var q=false;for(var i=0;i<m;i++){var o=C[i];if(s==o.getId()){q=true;break}}if(!q){h(L,s)}}}};var a=function(L,C,r){var s=C.getId();var t=C.getTitle();var p=new sap.ui.commons.Panel(s+"--Panel",{collapsed:!C.getExpanded(),content:[r]});p.attachEvent('collapsedToggled',j,L);p.__myParentContainer=C;p.__myParentLayout=L;p.getTitle=function(){var L=this.getParent();var P=this.getId();var s=P.substring(0,P.length-7);var C=sap.ui.getCore().byId(s);if(C){var t=C.getTitle();if(typeof t=="string"){return false}else{return t}}};p.getText=function(){var P=this.getId();var s=P.substring(0,P.length-7);var C=sap.ui.getCore().byId(s);if(C){var t=C.getTitle();if(t){if(typeof t=="string"){return t}else{return t.getText()}}else{return""}}};p.getShowCollapseIcon=function(){var P=this.getId();var s=P.substring(0,P.length-7);var C=sap.ui.getCore().byId(s);if(C){return C.getExpandable()}};p.getTooltip=function(){var P=this.getId();var s=P.substring(0,P.length-7);var C=sap.ui.getCore().byId(s);if(C){return C.getTooltip()}};p.getLayoutData=function(){var L=this.__myParentLayout;var C=this.__myParentContainer;if(C){return C.getLayoutData()}};return p};var b=function(p){p.__myParentContainer=undefined;p.__myParentLayout=undefined;p.removeAllContent();p.destroy();delete p};var c=function(L,C,o){var s=C.getId();var E=C.getFormElements();var m=E.length;var r={};if(L.mContainers[s]&&L.mContainers[s][2]){r=L.mContainers[s][2]}var R;var F;for(var i=0;i<m;i++){var n=E[i];var p=n.getId();if(r[p]){R=r[p][0]}else{R=d(L,C,n);r[p]=[R,undefined];o.insertContent(R,i)}var q=n.getFields();if(n.getLabel()&&q.length>1){if(r[p][1]){F=r[p][1]}else{F=d(L,C,n,true);r[p][1]=F}f(L,F,q)}else{if(r[p][1]){F=r[p][1];g(F);r[p][1]=undefined}}}var O=l(r);if(m<O){for(var p in r){var t=false;for(var i=0;i<m;i++){var n=E[i];if(p==n.getId()){t=true;break}}if(!t){if(r[p][1]){F=r[p][1];g(F)}R=r[p][0];o.removeContent(R);g(R);delete r[p]}}}return r};var d=function(L,C,E,i){var I;if(E&&!i){I=E.getId()+"--RFLayout"}else if(E&&i){I=E.getId()+"--content--RFLayout"}else if(C){I=C.getId()+"--RFLayout"}else{return}var r=new sap.ui.commons.layout.ResponsiveFlowLayout(I);r.__myParentLayout=L;r.__myParentContainer=C;if(E){r.__myParentElement=E;if(!i){r.getContent=function(){var E=this.__myParentElement;if(E){var m=new Array();var o=E.getLabelControl();var F=E.getFields();if(!o||F.length<=1){var m=F;if(o){m.unshift(o)}}else{var L=this.__myParentLayout;var C=this.__myParentContainer;var s=C.getId();var n=E.getId();if(o){m.push(o)}if(L.mContainers[s]&&L.mContainers[s][2]&&L.mContainers[s][2][n]){m.push(L.mContainers[s][2][n][1])}}return m}else{return false}}}else{r.getContent=function(){var E=this.__myParentElement;if(E){return E.getFields()}else{return false}}}}if((E&&!i)||(!E&&!C.getTitle()&&!C.getExpandable())){e(r,false)}return r};var e=function(r,o){if(o){if(r.__originalGetLayoutData){r.getLayoutData=r.__originalGetLayoutData;delete r.__originalGetLayoutData}}else if(!r.__originalGetLayoutData){r.__originalGetLayoutData=r.getLayoutData;r.getLayoutData=function(){var L=this.__myParentLayout;var C=this.__myParentContainer;var E=this.__myParentElement;if(E){return E.getLayoutData()}else if(C){return C.getLayoutData()}}}};var f=function(L,r,F){var o;var w=0;for(var i=0;i<F.length;i++){var m=F[i];o=L.getLayoutDataForElement(m,"sap.ui.commons.layout.ResponsiveFlowLayoutData");if(o){w=w+o.getWeight()}else{w++}}o=r.getLayoutData();if(o){o.setWeight(w)}else{r.setLayoutData(new sap.ui.commons.layout.ResponsiveFlowLayoutData({weight:w}))}};var g=function(r){if(r.__myParentContainer){r.__myParentContainer=undefined}if(r.__myParentElement){r.__myParentElement=undefined}r.__myParentLayout=undefined;r.destroy();delete r};var h=function(L,C){var i=L.mContainers[C];var r;var E=i[2];if(E){for(var s in E){if(E[s][1]){g(E[s][1])}r=E[s][0];g(r);delete E[s]}}r=i[1];if(r){r.removeAllContent();g(r)}var p=i[0];if(p){b(p)}delete L.mContainers[C]};var j=function(E){var p=E.oSource.getId();var C=p.substring(0,p.length-7);var o=sap.ui.getCore().byId(C);if(o){o.setProperty("expanded",!E.oSource.getCollapsed(),true)}};var k=function(L,F){var C=F.getFormContainers();var m=C.length;var n=0;if(m>1){if(!L._mainRFLayout){L._mainRFLayout=new sap.ui.commons.layout.ResponsiveFlowLayout(F.getId()+"--RFLayout").setParent(L)}else{var o=L._mainRFLayout.getContent();n=o.length;var E=false;for(var i=0;i<o.length;i++){var p=o[i];var q=C[i];if(q){var r=L.mContainers[q.getId()];if(r[0]&&r[0]!=p){E=true;break}if(!r[0]&&r[1]&&r[1]!=p){E=true;break}}else{L._mainRFLayout.removeContent(p)}}if(E){L._mainRFLayout.removeAllContent();n=0}}if(n<m){for(var i=0;i<m;i++){var q=C[i];var s=q.getId();if(L.mContainers[s]){if(L.mContainers[s][0]){L._mainRFLayout.addContent(L.mContainers[s][0])}else if(L.mContainers[s][1]){L._mainRFLayout.addContent(L.mContainers[s][1])}}}}}};var l=function(o){var L=0;if(!Object.keys){jQuery.each(o,function(){L++})}else{L=Object.keys(o).length}return L}}());
