/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2013 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.viz.ui5.data.FlattenedDataset");jQuery.sap.require("sap.viz.library");jQuery.sap.require("sap.viz.ui5.data.Dataset");sap.viz.ui5.data.Dataset.extend("sap.viz.ui5.data.FlattenedDataset",{metadata:{library:"sap.viz",aggregations:{"dimensions":{type:"sap.viz.ui5.data.DimensionDefinition",multiple:true,singularName:"dimension"},"measures":{type:"sap.viz.ui5.data.MeasureDefinition",multiple:true,singularName:"measure"},"data":{type:"sap.ui.core.Element",multiple:true,singularName:"data",bindable:"bindable"}}}});
sap.viz.ui5.data.FlattenedDataset.prototype.init=function(){};
sap.viz.ui5.data.FlattenedDataset.prototype.bindAggregation=function(n,b){if(n==="data"){if(typeof b=="string"){b={path:arguments[1],template:arguments[2],sorter:arguments[3],filters:arguments[4]};if(b.template instanceof sap.ui.model.Sorter||jQuery.isArray(b.sorter)&&b.sorter.length>0&&b.sorter[0]instanceof sap.ui.model.Filter){b.filters=b.sorter;b.sorter=b.template}}b.template=undefined;b.factory=function(){};return sap.ui.core.Element.prototype.bindAggregation.call(this,n,b)}return sap.ui.core.Element.prototype.bindAggregation.apply(this,arguments)};
sap.viz.ui5.data.FlattenedDataset.prototype.updateData=function(){this.invalidate()};
sap.viz.ui5.data.FlattenedDataset.prototype._createVIZCrosstab=function(){var b=this.getBinding("data"),c=b&&b.getContexts(0,b.getLength());if(!c||c.length===0){if(this._oVIZCrosstab){delete this._oVIZCrosstab;this.invalidate()}return}var a=[],A=[],m=[],d=[];jQuery.each(this.getDimensions(),function(i,C){if(C.getAxis()===1){a.push({def:C,adapter:C._getAdapter()})}else if(C.getAxis()===2){A.push({def:C,adapter:C._getAdapter()})}else{throw new Error("currently, only axis 1 and 2 are supported")}});jQuery.each(this.getMeasures(),function(i,C){m.push({def:C,adapter:C._getAdapter()});d.push([])});function g(n,o,C){var l=n.length,V,i;if(l===0){return 0}V=[];for(i=0;i<l;i++){V.push(n[i].adapter(C))}for(i=0,l=o.length;i<l;i++){if(jQuery.sap.equal(o[i],V)){return i}}o.push(V);return o.length-1}var e=[];var f=[];jQuery.each(c,function(I,C){var l=g(a,e,C);var n=g(A,f,C);for(var i=0;i<m.length;i++){var o=m[i].adapter(C);(d[i][n]=(d[i][n]||[]))[l]=o}});var h={analysisAxis:[],measureValuesGroup:[]};if(a.length>0){var k={index:1,data:[]};for(var i=0;i<a.length;i++){var v=[];for(var j=0;j<e.length;j++){v[j]=e[j][i]}k.data.push({name:a[i].def.getName(),values:v})}h.analysisAxis.push(k)}if(A.length>0){var k={index:2,data:[]};for(var i=0;i<A.length;i++){var v=[];for(var j=0;j<f.length;j++){v[j]=f[j][i]}k.data.push({name:A[i].def.getName(),values:v})}h.analysisAxis.push(k)}for(var i=0;i<m.length;i++){if(!h.measureValuesGroup[m[i].def.getGroup()-1]){h.measureValuesGroup[m[i].def.getGroup()-1]={index:m[i].def.getGroup(),data:[]}}h.measureValuesGroup[m[i].def.getGroup()-1].data.push({name:m[i].def.getName(),values:d[i]})}this._oVIZCrosstab=new sap.viz.data.CrosstableDataset();this._oVIZCrosstab.setData(h)};
sap.viz.ui5.data.FlattenedDataset.prototype.getVIZDataset=function(){if(!this._oVIZCrosstab&&sap.viz.__svg_support){this._createVIZCrosstab()}return this._oVIZCrosstab||null};
sap.viz.ui5.data.FlattenedDataset.prototype.invalidate=function(o){if(this._oVIZCrosstab){delete this._oVIZCrosstab}sap.ui.core.Element.prototype.invalidate.apply(this,arguments)};
